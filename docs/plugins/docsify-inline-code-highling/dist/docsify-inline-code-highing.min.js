// docsify-copy-code.js
(function() {
    // 自定义样式
    const style = document.createElement('style')
    style.textContent = `
    /* 行内代码高亮样式 */
    code:not(pre code) {
      background-color: #f3f4f4;
      border: 1px solid #e8e8e8;
      border-radius: 4px;
      padding: 2px 6px;
      margin: 0 2px; 
      cursor: pointer;
      transition: all 0.2s;
    }

    /* 点击反馈效果 */
    code:not(pre code):active {
      background-color: #e8e8e8;
    }

    /* 提示信息样式 */
    .copy-success-tip {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      animation: fadeOut 1.5s forwards;
      animation-delay: 0.5s;
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  `
    document.head.appendChild(style)

    // 显示复制成功的提示
    function showSuccessTip(content) {
        const tip = document.createElement('div')
        tip.className = 'copy-success-tip'
        tip.textContent = `已复制：${content}`
        document.body.appendChild(tip)
        setTimeout(() => tip.remove(), 2000)
    }

    // 处理复制操作
    async function copyToClipboard(text) {
        try {
            await navigator.clipboard.writeText(text)
            return true
        } catch (err) {
            console.error('复制失败:', err)
            return false
        }
    }

    // 初始化插件
    function init(hook, vm) {
        hook.doneEach(function() {
            // 选择所有行内代码（排除pre代码块内的）
            document.querySelectorAll('code:not(pre code)').forEach(code => {
                // 防止重复绑定
                if (!code.dataset.copyBound) {
                    code.dataset.copyBound = 'true'
                    code.addEventListener('click', async() => {
                        const text = code.textContent
                        const success = await copyToClipboard(text)
                        if (success) {
                            showSuccessTip(text)
                        }
                    })
                }
            })
        })
    }

    // 注册插件
    window.$docsify = window.$docsify || {}
    window.$docsify.plugins = [].concat(window.$docsify.plugins || [], init)
})()