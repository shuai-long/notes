<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GB2312" />
<title>ZFIB_010</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZFIB_010</h2>
<h3> Description: 资产负债表</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
<br />
<br />
*****************************************************************<br />
*&nbsp;&nbsp;System&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<br />
*&nbsp;&nbsp;Module&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;模块&nbsp;&nbsp;FICO<br />
*&nbsp;&nbsp;Program&nbsp;ID&nbsp;&nbsp;:&nbsp;&nbsp;ZFIB_010<br />
*&nbsp;&nbsp;Program&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;资产负债表<br />
*&nbsp;&nbsp;Author&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<br />
*&nbsp;&nbsp;Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<br />
*&nbsp;&nbsp;Description&nbsp;:&nbsp;&nbsp;资产负债表<br />
*****************************************************************<br />
*&nbsp;&nbsp;Modified&nbsp;Recorder&nbsp;:<br />
*&nbsp;&nbsp;Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C#NO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Author&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Content<br />
*&nbsp;&nbsp;-----------&nbsp;&nbsp;-------&nbsp;&nbsp;&nbsp;&nbsp;------------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---------------<br />
*&nbsp;&nbsp;修改日期&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C票或变更文档ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修改者&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修改内容<br />
*****************************************************************<br />
   </div>
   <div class="code">
REPORT zfib_001.<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------------------<br />
   </div>
   <div class="code">
TABLES: faglflext,sscrfields ,zfit_003.<br />
TYPE-POOLS: icon .<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------------------------<br />
*---TYPES<br />
*-----------------------------------------------------------------------------<br />
   </div>
   <div class="code">
TYPES: BEGIN OF typ_fag,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rbukrs&nbsp;LIKE&nbsp;faglflext-rbukrs,&nbsp;&nbsp;"公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ryear&nbsp;&nbsp;LIKE&nbsp;faglflext-ryear,&nbsp;&nbsp;&nbsp;"会计年度<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rpmax&nbsp;&nbsp;LIKE&nbsp;faglflext-rpmax,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;racct&nbsp;&nbsp;LIKE&nbsp;faglflext-racct,&nbsp;&nbsp;"科目号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rfarea&nbsp;LIKE&nbsp;faglflext-rfarea&nbsp;,&nbsp;"功能范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtcur&nbsp;&nbsp;LIKE&nbsp;faglflext-rtcur,&nbsp;&nbsp;"货币码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drcrk&nbsp;&nbsp;LIKE&nbsp;faglflext-drcrk,&nbsp;&nbsp;"借贷标识<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hslvt&nbsp;&nbsp;LIKE&nbsp;faglflext-hslvt,&nbsp;&nbsp;"年初结转数据<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl01&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl01,&nbsp;"&nbsp;对应每个月的发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl02&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl03&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl03,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl04&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl04,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl05&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl05,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl06&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl06,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl07&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl07,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl08&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl08,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl09&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl09,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl10&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl10,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl11&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl11,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl12&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl12,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl13&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl13,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl14&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl14,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl15&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl15,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl16&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl16,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;typ_fag&nbsp;.<br />
<br />
TYPES:BEGIN OF  typ_acd,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rbukrs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;acdoca-rbukrs,&nbsp;"公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;racct&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;acdoca-racct,&nbsp;&nbsp;"科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prctr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;acdoca-prctr,&nbsp;&nbsp;"利润中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fiscyearper&nbsp;TYPE&nbsp;acdoca-fiscyearper,&nbsp;"年度期间<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lifnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;acdoca-lifnr,&nbsp;"供应商<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kunnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;acdoca-kunnr,&nbsp;"客户<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zzfi01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;acdoca-zzfi01,&nbsp;"业务板块<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zzfi05&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;acdoca-zzfi01,&nbsp;"供应商<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;acdoca-hsl,&nbsp;"公司代码货币金额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;typ_acd.<br />
<br />
TYPES:BEGIN OF typ_lif,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lifnr&nbsp;&nbsp;TYPE&nbsp;acdoca-lifnr,&nbsp;"供应商<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;racct&nbsp;&nbsp;TYPE&nbsp;acdoca-racct,&nbsp;&nbsp;"科目<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zzfi01&nbsp;TYPE&nbsp;acdoca-zzfi01,&nbsp;"业务板块<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prctr&nbsp;&nbsp;TYPE&nbsp;acdoca-prctr,&nbsp;&nbsp;"利润中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;acdoca-hsl,&nbsp;"公司代码货币金额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;typ_lif.<br />
<br />
TYPES:BEGIN OF typ_kun,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kunnr&nbsp;&nbsp;TYPE&nbsp;acdoca-kunnr,&nbsp;"客户<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;racct&nbsp;&nbsp;TYPE&nbsp;acdoca-racct,&nbsp;&nbsp;"科目<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zzfi01&nbsp;TYPE&nbsp;acdoca-zzfi01,&nbsp;"业务板块<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prctr&nbsp;&nbsp;TYPE&nbsp;acdoca-prctr,&nbsp;&nbsp;"利润中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;acdoca-hsl,&nbsp;"公司代码货币金额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;typ_kun.<br />
<br />
<br />
<br />
TYPES: BEGIN OF typ_dmbtr ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zcolumn&nbsp;TYPE&nbsp;zfit_003-zcolumn,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zrow&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zfit_003-zrow,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dmbtr&nbsp;&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl01,&nbsp;&nbsp;&nbsp;"期末数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hslvt&nbsp;&nbsp;&nbsp;LIKE&nbsp;faglflext-hslvt,&nbsp;&nbsp;&nbsp;"年初数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;typ_dmbtr&nbsp;.<br />
<br />
TYPES: BEGIN OF typ_dmbtr1 ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zcolumn&nbsp;TYPE&nbsp;zfit_003-zcolumn,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zrow&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zfit_003-zrow,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ztext&nbsp;&nbsp;&nbsp;TYPE&nbsp;zfit_003-ztext,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hslvt&nbsp;&nbsp;&nbsp;LIKE&nbsp;faglflext-hslvt,&nbsp;&nbsp;&nbsp;"年初数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dmbtr&nbsp;&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl01,&nbsp;&nbsp;&nbsp;"期末数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;typ_dmbtr1&nbsp;.<br />
<br />
TYPES: BEGIN OF show_data , "显示到ALV上的数据结构<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zcolumn&nbsp;TYPE&nbsp;&nbsp;zfit_003-zcolumn,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zrow&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zfit_003-zrow,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ztext&nbsp;&nbsp;&nbsp;TYPE&nbsp;zfit_003-ztext,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"资产类文本<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dmbtr&nbsp;&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl01,&nbsp;&nbsp;&nbsp;"期末数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hslvt&nbsp;&nbsp;&nbsp;LIKE&nbsp;faglflext-hslvt,&nbsp;&nbsp;&nbsp;"年初数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zrow1&nbsp;&nbsp;&nbsp;TYPE&nbsp;zfit_003-zrow,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ztext1&nbsp;&nbsp;TYPE&nbsp;zfit_003-ztext,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"负债类文本<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dmbtr1&nbsp;&nbsp;LIKE&nbsp;faglflext-hsl01,&nbsp;&nbsp;&nbsp;"期末数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hslvt1&nbsp;&nbsp;LIKE&nbsp;faglflext-hslvt,&nbsp;&nbsp;&nbsp;"年初数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slbox&nbsp;&nbsp;&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;show_data&nbsp;.<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
"数据定义<br />
DATA: gt_fag TYPE STANDARD TABLE OF typ_fag, "<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_fag&nbsp;TYPE&nbsp;typ_fag.<br />
<br />
   </div>
   <div class="codeComment">
*DATA:&nbsp;gt_fag1&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;typ_fag,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_fag1&nbsp;TYPE&nbsp;typ_fag.<br />
<br />
   </div>
   <div class="code">
DATA:gt_acd TYPE TABLE OF typ_acd.<br />
<br />
DATA: gt_lif  TYPE TABLE OF typ_lif,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gt_lif1&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;typ_lif,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_lif&nbsp;&nbsp;TYPE&nbsp;typ_lif,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_lif1&nbsp;TYPE&nbsp;typ_lif,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gt_kun&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;typ_kun,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gt_kun1&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;typ_kun,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_kun&nbsp;&nbsp;TYPE&nbsp;typ_kun,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_kun1&nbsp;TYPE&nbsp;typ_kun.<br />
<br />
DATA: gt_fit001 TYPE STANDARD TABLE OF zfit_003,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_fit001&nbsp;TYPE&nbsp;zfit_003.<br />
FIELD-SYMBOLS: &lt;gs_fit001&gt; TYPE zfit_003.<br />
<br />
DATA: gt_dmbtr TYPE STANDARD TABLE OF typ_dmbtr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_dmbtr&nbsp;TYPE&nbsp;typ_dmbtr.<br />
<br />
DATA: gt_dmbtr1 TYPE STANDARD TABLE OF typ_dmbtr1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_dmbtr1&nbsp;TYPE&nbsp;typ_dmbtr1.<br />
<br />
DATA: tp_tcode LIKE sy-tcode .<br />
<br />
DATA: gt_show_data TYPE STANDARD TABLE OF show_data.<br />
TYPES:gty_show_data LIKE TABLE OF gt_show_data .<br />
DATA: gs_show_data TYPE show_data.<br />
FIELD-SYMBOLS: &lt;show_data&gt; TYPE show_data .<br />
<br />
DATA: gt_zfit_024 TYPE TABLE OF zfit_024.<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------------------*ALV&nbsp;相关参数<br />
<br />
   </div>
   <div class="code">
DATA: gs_fieldcatalog TYPE lvc_s_fcat, "显示数据列内表工作区域<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gt_fieldcatalog&nbsp;TYPE&nbsp;lvc_t_fcat,&nbsp;&nbsp;"显示数据列内表<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gt_alv_sort&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;lvc_t_sort&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_layout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;lvc_s_layo,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_pos&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;i.<br />
DATA: gt_header TYPE STANDARD TABLE OF slis_listheader,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_header&nbsp;TYPE&nbsp;slis_listheader.<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------------------EXCEL导出&nbsp;&nbsp;OLE相关参数<br />
   </div>
   <div class="code">
DATA:<br />
&nbsp;&nbsp;g_excel&nbsp;&nbsp;TYPE&nbsp;ole2_object,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"EXCEL&nbsp;object<br />
&nbsp;&nbsp;g_books&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;g_book&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"book<br />
&nbsp;&nbsp;g_sheets&nbsp;TYPE&nbsp;ole2_object,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"sheet<br />
&nbsp;&nbsp;g_cell&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"cell<br />
&nbsp;&nbsp;g_font&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;g_rows&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;g_cols&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"columns<br />
<br />
DATA: g_butxt     TYPE string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_excelname&nbsp;TYPE&nbsp;rlgrap-filename.<br />
   </div>
   <div class="codeComment">
***************************************************************************<br />
*execl定义《<br />
*DATA:<br />
*&nbsp;&nbsp;GV_EXCELOBJ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;OLE2_OBJECT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Excel&nbsp;object<br />
*&nbsp;&nbsp;GV_WBOOKOBJ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;OLE2_OBJECT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Workbook&nbsp;object<br />
*&nbsp;&nbsp;GV_WSHEETOBJ&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;OLE2_OBJECT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Worksheet&nbsp;object<br />
*&nbsp;&nbsp;GV_ROWSOBJ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;OLE2_OBJECT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Range&nbsp;object<br />
*&nbsp;&nbsp;GV_COLUMNSOBJ&nbsp;&nbsp;&nbsp;TYPE&nbsp;OLE2_OBJECT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Columns&nbsp;object<br />
*&nbsp;&nbsp;GV_BORDERSOBJ&nbsp;&nbsp;&nbsp;TYPE&nbsp;OLE2_OBJECT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Borders&nbsp;object<br />
*&nbsp;&nbsp;GV_FONTOBJ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;OLE2_OBJECT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Font&nbsp;object<br />
*&nbsp;&nbsp;GV_CELLOBJ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;OLE2_OBJECT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Cell&nbsp;object<br />
*&nbsp;&nbsp;GV_ST_CELLNAME&nbsp;&nbsp;TYPE&nbsp;STRING,<br />
*&nbsp;&nbsp;GV_END_CELLNAME&nbsp;TYPE&nbsp;STRING,<br />
*&nbsp;&nbsp;GV_ST_TEMP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STRING,<br />
*&nbsp;&nbsp;GV_V_XH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
*&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I.<br />
*DATA:&nbsp;GV_LINE(6).<br />
<br />
   </div>
   <div class="code">
DATA: myexcel    TYPE ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mysheet&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mycell&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mycell1&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mycell2&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myworkbook&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myfont&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myinterior&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mypicture&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myrange&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myrange1&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myentcol&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myborders&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myprotect&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myrange2&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myformat&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mycolumns&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myrows&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borders&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object.<br />
DATA:gv_index TYPE num4.<br />
<br />
DATA:alv_grid1      TYPE REF TO cl_gui_alv_grid, "cl_gui_alv_grid类引用<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alv_container1&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;cl_gui_docking_container.<br />
DATA: gs_toolbar TYPE stb_button."功能按钮<br />
DATA:layout   TYPE lvc_s_layo,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldcat&nbsp;TYPE&nbsp;lvc_t_fcat&nbsp;WITH&nbsp;HEADER&nbsp;LINE.&nbsp;"alv显示设置<br />
DATA:gt_alv  TYPE TABLE OF zfit_003.<br />
DATA:gt_alv1  TYPE TABLE OF zfit_003.<br />
<br />
CLASS cl_event_handle1 DEFINITION. "事件处理类定义<br />
&nbsp;&nbsp;PUBLIC&nbsp;SECTION.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;METHODS&nbsp;handle_toolbar&nbsp;FOR&nbsp;EVENT&nbsp;toolbar&nbsp;OF&nbsp;cl_gui_alv_grid&nbsp;"初始化ALV工具栏对象事件，如增加按钮并设定属性<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_object<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_interactive.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;METHODS&nbsp;handle_user_command&nbsp;FOR&nbsp;EVENT&nbsp;user_command&nbsp;OF&nbsp;cl_gui_alv_grid&nbsp;&nbsp;&nbsp;&nbsp;"ALV工具栏按钮的点击事件<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_ucomm.<br />
*<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;METHODS&nbsp;handle_enter&nbsp;FOR&nbsp;EVENT&nbsp;&nbsp;data_changed_finished&nbsp;OF&nbsp;cl_gui_alv_grid&nbsp;&nbsp;"用户输入enter事件<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_modified<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et_good_cells.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;METHODS&nbsp;handle_onf4&nbsp;FOR&nbsp;EVENT&nbsp;onf4&nbsp;OF&nbsp;cl_gui_alv_grid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"增加搜索帮助<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_fieldname&nbsp;"代表用户点击了ALV的哪个字段来触发搜索帮助，<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;es_row_no&nbsp;&nbsp;&nbsp;"代表了当前行信息，es_row_no-row_id就是ALV中内表记录的INDEX。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;er_event_data."当前用户对ALV进行了哪些编辑的信息<br />
<br />
ENDCLASS.<br />
CLASS cl_event_handle1 IMPLEMENTATION."事件处理类实现部分<br />
<br />
&nbsp;&nbsp;METHOD&nbsp;handle_toolbar.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;gs_toolbar-function&nbsp;=&nbsp;'PLDR'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"按钮的FunctionCode<br />
*&nbsp;&nbsp;&nbsp;&nbsp;gs_toolbar-text&nbsp;=&nbsp;'批量导入'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"按钮标签<br />
*&nbsp;&nbsp;&nbsp;&nbsp;gs_toolbar-butn_type&nbsp;=&nbsp;'0'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"定义按钮类型，0为标准按钮，具体取值可参考这里<br />
*&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_toolbar&nbsp;TO&nbsp;e_object-&gt;mt_toolbar."添加按钮到工具栏中<br />
<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;e_object-&gt;mt_toolbar&nbsp;WHERE&nbsp;quickinfo&nbsp;=&nbsp;'刷新'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;e_object-&gt;mt_toolbar&nbsp;WHERE&nbsp;quickinfo&nbsp;=&nbsp;'检查条目'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;e_object-&gt;mt_toolbar&nbsp;WHERE&nbsp;quickinfo&nbsp;=&nbsp;'剪切'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;e_object-&gt;mt_toolbar&nbsp;WHERE&nbsp;quickinfo&nbsp;=&nbsp;'复制文本'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;e_object-&gt;mt_toolbar&nbsp;WHERE&nbsp;quickinfo&nbsp;=&nbsp;'插入并重写'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;e_object-&gt;mt_toolbar&nbsp;WHERE&nbsp;quickinfo&nbsp;=&nbsp;'附加行'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;e_object-&gt;mt_toolbar&nbsp;WHERE&nbsp;quickinfo&nbsp;=&nbsp;'插入行'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;e_object-&gt;mt_toolbar&nbsp;WHERE&nbsp;quickinfo&nbsp;=&nbsp;'复制行'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;e_object-&gt;mt_toolbar&nbsp;WHERE&nbsp;quickinfo&nbsp;=&nbsp;'撤消'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;e_object-&gt;mt_toolbar&nbsp;WHERE&nbsp;quickinfo&nbsp;=&nbsp;'删除行'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDMETHOD.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;METHOD&nbsp;handle_user_command.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;sum&nbsp;TYPE&nbsp;i&nbsp;.<br />
*<br />
**&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;e_ucomm.<br />
*<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BC'.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;frm_data_bc.<br />
*<br />
**&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
*<br />
*&nbsp;&nbsp;ENDMETHOD.<br />
*<br />
*&nbsp;&nbsp;METHOD&nbsp;handle_enter.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;frm_refresh_display.<br />
*&nbsp;&nbsp;ENDMETHOD.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;METHOD&nbsp;handle_onf4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_modi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;lvc_s_modi,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_ret_tab&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ddshretval,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_ret_tab&nbsp;&nbsp;&nbsp;TYPE&nbsp;ddshretval,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_field_tab&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;dfies.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;FIELD-SYMBOLS&nbsp;&lt;modtab&gt;&nbsp;TYPE&nbsp;lvc_t_modi.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA:BEGIN&nbsp;OF&nbsp;&nbsp;ls_hitlist,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zwldw&nbsp;TYPE&nbsp;ze_wldw,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ztext&nbsp;TYPE&nbsp;char10,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ls_hitlist.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_hitlist&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;ls_hitlist.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;ls_hitlist1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zjdqz&nbsp;TYPE&nbsp;ze_jdqz,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ztext&nbsp;TYPE&nbsp;char10,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ls_hitlist1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_hitlist1&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;ls_hitlist1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;e_fieldname&nbsp;=&nbsp;'ZWLDW'.&nbsp;"我们自定义搜索的字段名<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_alv&nbsp;INTO&nbsp;DATA(ls_alv)&nbsp;INDEX&nbsp;es_row_no-row_id.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
   </div>
   <div class="codeComment">
**&nbsp;&nbsp;这里可以添加代码以对lt_hitlist内表进行填充<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_hitlist.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_hitlist-zwldw&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_hitlist-ztext&nbsp;=&nbsp;&nbsp;'客户'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_hitlist&nbsp;TO&nbsp;lt_hitlist.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_hitlist.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_hitlist-zwldw&nbsp;=&nbsp;'2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_hitlist-ztext&nbsp;=&nbsp;&nbsp;'供应商'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_hitlist&nbsp;TO&nbsp;lt_hitlist.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'F4IF_INT_TABLE_VALUE_REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retfield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZWLDW'&nbsp;&nbsp;&nbsp;&nbsp;"内表对应的字段<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpprog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-repid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;定义系统变量自动获取程序名称<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-dynnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"定义系统变量自动获取程序编号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynprofield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZWLDW'&nbsp;&nbsp;"&nbsp;屏幕接收值得字段<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_org&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'S'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_hitlist[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"传入搜索帮助值的内表<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_field_tab<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_ret_tab<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter_error&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_values_found&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
   </div>
   <div class="codeComment">
**&nbsp;&nbsp;Update&nbsp;the&nbsp;value&nbsp;in&nbsp;ALV&nbsp;cell<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_ret_tab&nbsp;INTO&nbsp;ls_ret_tab&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.&nbsp;"&nbsp;User&nbsp;didn't&nbsp;cancel<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_modi-row_id&nbsp;=&nbsp;es_row_no-row_id.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_modi-fieldname&nbsp;=&nbsp;e_fieldname.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_modi-value&nbsp;=&nbsp;ls_ret_tab-fieldval.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;er_event_data-&gt;m_data-&gt;*&nbsp;TO&nbsp;&lt;modtab&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_modi&nbsp;TO&nbsp;&lt;modtab&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;e_fieldname&nbsp;=&nbsp;'ZJDQZ'.&nbsp;"我们自定义搜索的字段名<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_alv&nbsp;INTO&nbsp;ls_alv&nbsp;INDEX&nbsp;es_row_no-row_id.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
   </div>
   <div class="codeComment">
**&nbsp;&nbsp;这里可以添加代码以对lt_hitlist内表进行填充<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_hitlist1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_hitlist1-zjdqz&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_hitlist1-ztext&nbsp;=&nbsp;&nbsp;'取余额'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_hitlist1&nbsp;TO&nbsp;lt_hitlist1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_hitlist1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_hitlist1-zjdqz&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_hitlist1-ztext&nbsp;=&nbsp;&nbsp;'取借方余额'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_hitlist1&nbsp;TO&nbsp;lt_hitlist1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_hitlist1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_hitlist1-zjdqz&nbsp;=&nbsp;'2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_hitlist1-ztext&nbsp;=&nbsp;&nbsp;'取贷方余额'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_hitlist1&nbsp;TO&nbsp;lt_hitlist1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'F4IF_INT_TABLE_VALUE_REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retfield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZJDQZ'&nbsp;&nbsp;&nbsp;&nbsp;"内表对应的字段<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpprog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-repid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;定义系统变量自动获取程序名称<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-dynnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"定义系统变量自动获取程序编号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynprofield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZJDQZ'&nbsp;&nbsp;"&nbsp;屏幕接收值得字段<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_org&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'S'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_hitlist1[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"传入搜索帮助值的内表<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_field_tab<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_ret_tab<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter_error&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_values_found&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
   </div>
   <div class="codeComment">
**&nbsp;&nbsp;Update&nbsp;the&nbsp;value&nbsp;in&nbsp;ALV&nbsp;cell<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_ret_tab&nbsp;INTO&nbsp;ls_ret_tab&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.&nbsp;"&nbsp;User&nbsp;didn't&nbsp;cancel<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_modi-row_id&nbsp;=&nbsp;es_row_no-row_id.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_modi-fieldname&nbsp;=&nbsp;e_fieldname.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_modi-value&nbsp;=&nbsp;ls_ret_tab-fieldval.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;er_event_data-&gt;m_data-&gt;*&nbsp;TO&nbsp;&lt;modtab&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_modi&nbsp;TO&nbsp;&lt;modtab&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;er_event_data-&gt;m_event_handled&nbsp;=&nbsp;'X'.&nbsp;"在Method的最后，记得加上<br />
&nbsp;&nbsp;ENDMETHOD.<br />
<br />
ENDCLASS.<br />
DATA: event_handle1 TYPE REF TO cl_event_handle1."定义类对象的引用<br />
<br />
   </div>
   <div class="codeComment">
***************************************************************************<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;选择屏幕<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
SELECTION-SCREEN BEGIN OF BLOCK blk1 WITH FRAME TITLE TEXT-001.<br />
<br />
&nbsp;&nbsp;PARAMETERS&nbsp;p_vers&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zfit_003-version&nbsp;&nbsp;OBLIGATORY.<br />
&nbsp;&nbsp;PARAMETERS&nbsp;p_bukrs&nbsp;&nbsp;&nbsp;LIKE&nbsp;faglflext-rbukrs&nbsp;OBLIGATORY&nbsp;MEMORY&nbsp;ID&nbsp;buk.&nbsp;&nbsp;&nbsp;"&nbsp;公司代码<br />
&nbsp;&nbsp;SELECT-OPTIONS&nbsp;s_prctr&nbsp;FOR&nbsp;faglflext-prctr&nbsp;."利润中心<br />
&nbsp;&nbsp;PARAMETERS&nbsp;p_ryear&nbsp;&nbsp;&nbsp;LIKE&nbsp;faglflext-ryear&nbsp;&nbsp;OBLIGATORY&nbsp;DEFAULT&nbsp;sy-datum+0(4)."&nbsp;会计年度<br />
&nbsp;&nbsp;PARAMETERS&nbsp;p_rpmax&nbsp;&nbsp;&nbsp;LIKE&nbsp;faglflext-rpmax&nbsp;&nbsp;OBLIGATORY&nbsp;DEFAULT&nbsp;sy-datum+4(2)&nbsp;.&nbsp;"&nbsp;会计期间<br />
<br />
&nbsp;&nbsp;PARAMETERS:p_1&nbsp;TYPE&nbsp;c&nbsp;AS&nbsp;CHECKBOX&nbsp;USER-COMMAND&nbsp;uc&nbsp;&nbsp;DEFAULT&nbsp;''.<br />
<br />
SELECTION-SCREEN END OF BLOCK blk1.<br />
<br />
<br />
SELECTION-SCREEN FUNCTION KEY 1. "在选择屏幕工具拦上加按钮<br />
   </div>
   <div class="codeComment">
*SELECTION-SCREEN&nbsp;FUNCTION&nbsp;KEY&nbsp;2.&nbsp;&nbsp;"在选择屏幕工具拦上加按钮<br />
   </div>
   <div class="code">
DATA: functxt TYPE smp_dyntxt.<br />
DATA: functxt2 TYPE smp_dyntxt.<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------------------------<br />
*---事件处理<br />
*-----------------------------------------------------------------------------<br />
   </div>
   <div class="code">
INITIALIZATION .<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-langu&nbsp;NE&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;mod_sel_text&nbsp;USING&nbsp;sy-repid&nbsp;'P'&nbsp;'P_BUKRS'&nbsp;'Company&nbsp;Code'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;mod_sel_text&nbsp;USING&nbsp;sy-repid&nbsp;'P'&nbsp;'P_RYEAR'&nbsp;'Accounting&nbsp;Year'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;mod_sel_text&nbsp;USING&nbsp;sy-repid&nbsp;'P'&nbsp;'P_RPMAX'&nbsp;'Accounting&nbsp;Period'.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
***改变按钮名称<br />
*&nbsp;&nbsp;IF&nbsp;SY-LANGU&nbsp;=&nbsp;'1'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;functxt-icon_text&nbsp;&nbsp;=&nbsp;'配置数据维护'&nbsp;.&nbsp;&nbsp;&nbsp;"按钮文本<br />
&nbsp;&nbsp;functxt2-icon_text&nbsp;&nbsp;=&nbsp;'模板下载'&nbsp;.&nbsp;&nbsp;&nbsp;"按钮文本<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;FUNCTXT-ICON_TEXT&nbsp;&nbsp;=&nbsp;'Data&nbsp;Maintenance'&nbsp;.&nbsp;&nbsp;&nbsp;"按钮文本<br />
**&nbsp;&nbsp;FUNCTXT2-ICON_TEXT&nbsp;&nbsp;=&nbsp;'Data&nbsp;Maintenance'&nbsp;.&nbsp;&nbsp;&nbsp;"按钮文本<br />
*&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;functxt-icon_id&nbsp;&nbsp;&nbsp;=&nbsp;icon_toggle_display_change&nbsp;.&nbsp;&nbsp;"按钮图标<br />
&nbsp;&nbsp;functxt2-icon_id&nbsp;&nbsp;&nbsp;=&nbsp;icon_export.&nbsp;&nbsp;"按钮图标<br />
&nbsp;&nbsp;sscrfields-functxt_01&nbsp;=&nbsp;functxt&nbsp;.<br />
&nbsp;&nbsp;sscrfields-functxt_02&nbsp;=&nbsp;functxt2&nbsp;.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;tp_tcode&nbsp;.<br />
&nbsp;&nbsp;tp_tcode&nbsp;=&nbsp;sy-tcode&nbsp;.<br />
&nbsp;&nbsp;PERFORM&nbsp;initial_screen&nbsp;.<br />
<br />
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_vers.<br />
&nbsp;&nbsp;PERFORM&nbsp;zf4_help_low.<br />
<br />
<br />
AT SELECTION-SCREEN OUTPUT.<br />
   </div>
   <div class="codeComment">
*<br />
*AT&nbsp;SELECTION-SCREEN&nbsp;ON&nbsp;VALUE-REQUEST&nbsp;FOR&nbsp;P_VERS.<br />
*&nbsp;&nbsp;PERFORM&nbsp;FRM_VERSION_HELP(ZFIR016_A)&nbsp;CHANGING&nbsp;P_VERS.<br />
<br />
   </div>
   <div class="code">
AT SELECTION-SCREEN ON p_bukrs. " 公司代码权限检查 By ChenJian 20210311<br />
&nbsp;&nbsp;PERFORM&nbsp;frm_authority_check_bukrs.<br />
<br />
AT SELECTION-SCREEN .<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-ucomm&nbsp;=&nbsp;'FC01'.&nbsp;&nbsp;&nbsp;&nbsp;"调用配置程序&nbsp;&nbsp;已维护配置数据<br />
<br />
   </div>
   <div class="codeComment">
*******************************change&nbsp;by&nbsp;zhangsl&nbsp;20220117*****************<br />
*将SM30的维护更改为ALV.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;TRANSACTION&nbsp;'ZFIT003'&nbsp;.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;frm_get_data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;9001.<br />
   </div>
   <div class="codeComment">
*******************************change&nbsp;by&nbsp;zhangsl&nbsp;20220117*****************<br />
<br />
<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SUBMIT&nbsp;ZFIU004&nbsp;WITH&nbsp;ZTYPE&nbsp;=&nbsp;'BS'&nbsp;AND&nbsp;RETURN&nbsp;.<br />
**&nbsp;&nbsp;ELSEIF&nbsp;&nbsp;SY-UCOMM&nbsp;=&nbsp;'FC02'.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;OUTPUT_EXCEL&nbsp;.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDIF.<br />
<br />
START-OF-SELECTION .<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;PERFORM&nbsp;sub_authority_check&nbsp;.&nbsp;&nbsp;"权限校验<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;p_1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;frm_get_data.<br />
<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;sub_get_data&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gt_fit001[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;sub_deal_data&nbsp;.&nbsp;"数据处理<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-langu&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'没有资产负债表对应配置数据!!'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'No&nbsp;balance&nbsp;sheet&nbsp;corresponding&nbsp;configuration&nbsp;data!!'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
END-OF-SELECTION .<br />
&nbsp;&nbsp;PERFORM&nbsp;sub_create_show&nbsp;.<br />
&nbsp;&nbsp;PERFORM&nbsp;sub_show_data&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;INITIAL_SCREEN<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM initial_screen .<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------------------*<br />
<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SUB_GET_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM sub_get_data .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;tp_cond&nbsp;&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tp_field&nbsp;TYPE&nbsp;c&nbsp;LENGTH&nbsp;5.<br />
&nbsp;&nbsp;DATA&nbsp;&nbsp;tp_perio&nbsp;TYPE&nbsp;char3&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;tp_monat&nbsp;TYPE&nbsp;c&nbsp;LENGTH&nbsp;2&nbsp;VALUE&nbsp;'00'.<br />
&nbsp;&nbsp;DATA:lv_fiscyearper(7)&nbsp;TYPE&nbsp;c.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;tp_perio&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;IF&nbsp;p_rpmax&nbsp;=&nbsp;12&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;tp_perio&nbsp;=&nbsp;p_rpmax&nbsp;+&nbsp;4&nbsp;.<br />
*&nbsp;&nbsp;ELSE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;tp_perio&nbsp;=&nbsp;p_rpmax&nbsp;.<br />
*&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;tp_perio&nbsp;=&nbsp;p_rpmax.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;tp_cond,tp_monat&nbsp;.<br />
&nbsp;&nbsp;DO&nbsp;tp_perio&nbsp;TIMES.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"动态组织查询条件（根据查询期间，只查询&lt;=&nbsp;该期间的发生额的字段）<br />
&nbsp;&nbsp;&nbsp;&nbsp;tp_monat&nbsp;=&nbsp;tp_monat&nbsp;+&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SHIFT&nbsp;tp_monat&nbsp;RIGHT&nbsp;DELETING&nbsp;TRAILING&nbsp;space&nbsp;.&nbsp;&nbsp;"字符串左移<br />
&nbsp;&nbsp;&nbsp;&nbsp;OVERLAY&nbsp;tp_monat&nbsp;WITH&nbsp;'00'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;tp_field&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'HSL'&nbsp;tp_monat&nbsp;INTO&nbsp;&nbsp;tp_field&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;tp_cond&nbsp;tp_field&nbsp;INTO&nbsp;tp_cond&nbsp;SEPARATED&nbsp;BY&nbsp;space&nbsp;.<br />
&nbsp;&nbsp;ENDDO.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'RBUKRS'&nbsp;'RYEAR'&nbsp;'RPMAX'&nbsp;'RACCT'&nbsp;'RTCUR'&nbsp;'DRCRK'&nbsp;'RFAREA'&nbsp;'HSLVT'<br />
&nbsp;&nbsp;tp_cond&nbsp;INTO&nbsp;tp_cond&nbsp;SEPARATED&nbsp;BY&nbsp;space&nbsp;.&nbsp;&nbsp;"经过整合&nbsp;&nbsp;&nbsp;tp_cond&nbsp;字符串里面就是select&nbsp;中所有需要查询的字段信息<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;(tp_cond)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"获取该公司代码下所有科目的发生额数据<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;gt_fag&nbsp;&nbsp;&nbsp;"<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;faglflext<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;rbukrs&nbsp;=&nbsp;p_bukrs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ryear&nbsp;&nbsp;=&nbsp;p_ryear<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;rldnr&nbsp;&nbsp;=&nbsp;'0L'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;prctr&nbsp;IN&nbsp;s_prctr.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;AND&nbsp;AWTYP&nbsp;IN&nbsp;('BKPF','AUAK','AIBU','BKPFF','AMBU','HRPAY','AMDP','RMRP','MKPF','AS91')<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;lv_fiscyearper&nbsp;=&nbsp;p_ryear&nbsp;&&&nbsp;p_rpmax.<br />
<br />
&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rbukrs,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;racct,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prctr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fiscyearper,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lifnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kunnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zzfi01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zzfi05,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;gt_acd<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;acdoca<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;rbukrs&nbsp;EQ&nbsp;@p_bukrs<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;prctr&nbsp;IN&nbsp;@s_prctr<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;fiscyearper&nbsp;LE&nbsp;@lv_fiscyearper<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;substring(&nbsp;fiscyearper&nbsp;,&nbsp;5&nbsp;,&nbsp;3&nbsp;)&nbsp;NE&nbsp;'000'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;gjahr&nbsp;LE&nbsp;@p_ryear<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@gt_acd<br />
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;&nbsp;"获取配置表数据&nbsp;&nbsp;资产负债表对应科目范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;gt_fit001<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zfit_003<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;bukrs&nbsp;&nbsp;&nbsp;=&nbsp;''<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ztype&nbsp;&nbsp;&nbsp;=&nbsp;'BS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;version&nbsp;=&nbsp;p_vers.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;langu&nbsp;&nbsp;&nbsp;=&nbsp;sy-langu.<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;gt_fit001&nbsp;BY&nbsp;ztype&nbsp;zcolumn&nbsp;zrow&nbsp;zsnum&nbsp;.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SUB_DEAL_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM sub_deal_data .<br />
<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;hsl&gt;&nbsp;TYPE&nbsp;any&nbsp;.<br />
&nbsp;&nbsp;RANGES:&nbsp;r_saknr&nbsp;FOR&nbsp;faglflext-racct.<br />
&nbsp;&nbsp;RANGES:&nbsp;r_rfarea&nbsp;FOR&nbsp;zfit_003-frfarea&nbsp;."资产负债表不存在功能范围<br />
&nbsp;&nbsp;RANGES:&nbsp;r_drcrk&nbsp;FOR&nbsp;faglflext-drcrk&nbsp;.<br />
<br />
&nbsp;&nbsp;DATA:lv_fiscyearper(7)&nbsp;TYPE&nbsp;c.<br />
&nbsp;&nbsp;lv_fiscyearper&nbsp;=&nbsp;|{&nbsp;p_ryear&nbsp;-&nbsp;1&nbsp;}|&nbsp;&&&nbsp;'016'.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;gt_dmbtr[].<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_fit001&nbsp;ASSIGNING&nbsp;&lt;gs_fit001&gt;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gs_dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;NOT&nbsp;(&nbsp;&lt;gs_fit001&gt;-zjfbs&nbsp;=&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-zdfbs&nbsp;=&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-formula&nbsp;=&nbsp;''&nbsp;)."借方标识、贷方标识、公式均为空，则不进行数据处理<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&lt;gs_fit001&gt;&nbsp;TO&nbsp;gs_dmbtr&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-formula&nbsp;=&nbsp;''&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"不是通过公式计算<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;(&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;&lt;&gt;&nbsp;''&nbsp;OR&nbsp;&lt;gs_fit001&gt;-tsaknr&nbsp;&lt;&gt;&nbsp;''&nbsp;)&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&lt;gs_fit001&gt;-zjfbs&nbsp;&lt;&gt;&nbsp;''&nbsp;OR&nbsp;&lt;gs_fit001&gt;-zdfbs&nbsp;&lt;&gt;&nbsp;''&nbsp;)&nbsp;)&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------------------------<br />
*---组织整合条件<br />
*-----------------------------------------------------------------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:r_saknr[],r_drcrk[],r_rfarea[]&nbsp;.&nbsp;&nbsp;&nbsp;"资产负债表没有功能范围<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;r_saknr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;&lt;&gt;&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-tsaknr&nbsp;=&nbsp;''&nbsp;.&nbsp;&nbsp;"根据配置整合科目范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_saknr-sign&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_saknr-option&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_saknr-low&nbsp;=&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;r_saknr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;=&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-tsaknr&nbsp;&lt;&gt;&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_saknr-sign&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_saknr-option&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_saknr-low&nbsp;=&nbsp;&lt;gs_fit001&gt;-tsaknr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;r_saknr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;&lt;&gt;&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-tsaknr&nbsp;&lt;&gt;&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_saknr-sign&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_saknr-option&nbsp;=&nbsp;'BT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_saknr-low&nbsp;=&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_saknr-high&nbsp;=&nbsp;&lt;gs_fit001&gt;-tsaknr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;r_saknr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;r_rfarea.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-frfarea&nbsp;&lt;&gt;&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-trfarea&nbsp;=&nbsp;''&nbsp;.&nbsp;&nbsp;"根据配置整合功能范围&nbsp;&nbsp;&nbsp;的范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_rfarea-sign&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_rfarea-option&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_rfarea-low&nbsp;=&nbsp;&lt;gs_fit001&gt;-frfarea&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;r_rfarea&nbsp;.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;gs_fit001&gt;-frfarea&nbsp;=&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-trfarea&nbsp;&lt;&gt;&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_rfarea-sign&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_rfarea-option&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_rfarea-low&nbsp;=&nbsp;&lt;gs_fit001&gt;-trfarea&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;r_rfarea&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;gs_fit001&gt;-frfarea&nbsp;&lt;&gt;&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-trfarea&nbsp;&lt;&gt;&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_rfarea-sign&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_rfarea-option&nbsp;=&nbsp;'BT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_rfarea-low&nbsp;=&nbsp;&lt;gs_fit001&gt;-frfarea&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_rfarea-high&nbsp;=&nbsp;&lt;gs_fit001&gt;-trfarea.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;r_rfarea&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:r_drcrk&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"借贷标识<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-zjfbs&nbsp;=&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_drcrk(3)&nbsp;=&nbsp;'IEQ'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_drcrk-low&nbsp;=&nbsp;'S'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;r_drcrk&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-zdfbs&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_drcrk(3)&nbsp;=&nbsp;'IEQ'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_drcrk-low&nbsp;=&nbsp;'H'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;r_drcrk&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-zwldw&nbsp;EQ&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_acd&nbsp;INTO&nbsp;DATA(ls_acd)&nbsp;WHERE&nbsp;racct&nbsp;IN&nbsp;r_saknr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ls_acd&nbsp;TO&nbsp;gs_kun.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;gs_kun&nbsp;INTO&nbsp;gt_kun.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_kun.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_acd-fiscyearper&nbsp;LE&nbsp;lv_fiscyearper.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ls_acd&nbsp;TO&nbsp;gs_kun1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;gs_kun1&nbsp;INTO&nbsp;gt_kun1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_kun1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;gt_kun&nbsp;BY&nbsp;kunnr.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-zjdqz&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_kun&nbsp;INTO&nbsp;gs_kun&nbsp;WHERE&nbsp;hsl&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;gs_kun-hsl&nbsp;TO&nbsp;gs_dmbtr-dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_kun1&nbsp;INTO&nbsp;gs_kun1&nbsp;WHERE&nbsp;hsl&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;gs_kun1-hsl&nbsp;TO&nbsp;gs_dmbtr-hslvt&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-zjdqz&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_kun&nbsp;INTO&nbsp;gs_kun&nbsp;WHERE&nbsp;hsl&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;gs_kun-hsl&nbsp;TO&nbsp;gs_dmbtr-dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_kun1&nbsp;INTO&nbsp;gs_kun1&nbsp;WHERE&nbsp;hsl&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;gs_kun1-hsl&nbsp;TO&nbsp;gs_dmbtr-hslvt&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;gt_kun,gt_kun1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;gs_fit001&gt;-zwldw&nbsp;EQ&nbsp;'2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_acd&nbsp;INTO&nbsp;ls_acd&nbsp;WHERE&nbsp;racct&nbsp;IN&nbsp;r_saknr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_acd-lifnr&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_acd-lifnr&nbsp;=&nbsp;ls_acd-zzfi05.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ls_acd&nbsp;TO&nbsp;gs_lif&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;gs_lif&nbsp;INTO&nbsp;gt_lif.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_lif.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_acd-fiscyearper&nbsp;LE&nbsp;lv_fiscyearper.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ls_acd&nbsp;TO&nbsp;gs_lif1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;gs_lif1&nbsp;INTO&nbsp;gt_lif1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_lif1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;gt_lif&nbsp;BY&nbsp;lifnr.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-zjdqz&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_lif&nbsp;INTO&nbsp;gs_lif&nbsp;WHERE&nbsp;hsl&nbsp;&gt;&nbsp;0..<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;gs_lif-hsl&nbsp;TO&nbsp;gs_dmbtr-dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_lif1&nbsp;INTO&nbsp;gs_lif1&nbsp;WHERE&nbsp;hsl&nbsp;&gt;&nbsp;0..<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;gs_lif1-hsl&nbsp;TO&nbsp;gs_dmbtr-hslvt&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-zjdqz&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_lif&nbsp;INTO&nbsp;gs_lif&nbsp;WHERE&nbsp;hsl&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;gs_lif-hsl&nbsp;TO&nbsp;gs_dmbtr-dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_lif1&nbsp;INTO&nbsp;gs_lif1&nbsp;WHERE&nbsp;hsl&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;gs_lif1-hsl&nbsp;TO&nbsp;gs_dmbtr-hslvt&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;gt_lif,&nbsp;gt_lif1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_fag&nbsp;INTO&nbsp;gs_fag&nbsp;WHERE&nbsp;racct&nbsp;IN&nbsp;r_saknr&nbsp;AND&nbsp;rfarea&nbsp;IN&nbsp;r_rfarea&nbsp;AND&nbsp;drcrk&nbsp;IN&nbsp;r_drcrk.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_fag&nbsp;INTO&nbsp;gs_fag&nbsp;WHERE&nbsp;racct&nbsp;IN&nbsp;r_saknr&nbsp;AND&nbsp;drcrk&nbsp;IN&nbsp;r_drcrk.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;gs_fag-hslvt&nbsp;TO&nbsp;gs_dmbtr-hslvt&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;gs_fag-hslvt&nbsp;TO&nbsp;gs_dmbtr-dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DO&nbsp;16&nbsp;TIMES.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;(&nbsp;sy-index&nbsp;+&nbsp;8&nbsp;)&nbsp;OF&nbsp;STRUCTURE&nbsp;gs_fag&nbsp;TO&nbsp;&lt;hsl&gt;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;&lt;hsl&gt;&nbsp;TO&nbsp;gs_dmbtr-dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDDO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-zjdqz&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gs_dmbtr-hslvt&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_dmbtr-hslvt&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gs_dmbtr-dmbtr&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_dmbtr-dmbtr&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-zjdqz&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gs_dmbtr-hslvt&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_dmbtr-hslvt&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gs_dmbtr-dmbtr&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_dmbtr-dmbtr&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;正负调转<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-reversal&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_dmbtr-dmbtr&nbsp;=&nbsp;0&nbsp;-&nbsp;gs_dmbtr-dmbtr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_dmbtr-hslvt&nbsp;=&nbsp;0&nbsp;-&nbsp;gs_dmbtr-hslvt.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;gs_dmbtr&nbsp;INTO&nbsp;gt_dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;gs_dmbtr&nbsp;INTO&nbsp;gt_dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"公式计算项<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;caculate_results&nbsp;CHANGING&nbsp;&lt;gs_fit001&gt;-formula&nbsp;gs_dmbtr-hslvt&nbsp;gs_dmbtr-dmbtr&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;"有计算公式的行没有分科目号段造成多行的问题<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;gs_dmbtr&nbsp;INTO&nbsp;gt_dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF&nbsp;.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CACULATE_RESULTS<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_GS_PZB01_FORMULA&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM caculate_results CHANGING p_formula p_hslvt p_dmbtr . "此form 用于解析配置表的公式计算，根据公式来计算该行的值<br />
&nbsp;&nbsp;DATA:&nbsp;wa_dmbtr&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;gt_dmbtr&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;formula_len&nbsp;TYPE&nbsp;&nbsp;i,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;DATA:&nbsp;tp_char&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_row&nbsp;&nbsp;&nbsp;TYPE&nbsp;c&nbsp;LENGTH&nbsp;3.<br />
&nbsp;&nbsp;DATA:&nbsp;tp_hslvt&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tp_dmbtr&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tp_value&nbsp;TYPE&nbsp;string.<br />
&nbsp;&nbsp;DATA:&nbsp;l_value&nbsp;TYPE&nbsp;f&nbsp;.<br />
<br />
&nbsp;&nbsp;formula_len&nbsp;=&nbsp;strlen(&nbsp;p_formula&nbsp;)&nbsp;.&nbsp;&nbsp;&nbsp;"计算公式长度<br />
<br />
&nbsp;&nbsp;CLEAR:tp_hslvt,tp_dmbtr,tp_char,l_row&nbsp;.<br />
&nbsp;&nbsp;CONDENSE&nbsp;p_formula&nbsp;NO-GAPS&nbsp;.<br />
&nbsp;&nbsp;DO&nbsp;formula_len&nbsp;TIMES.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"循环整个公式&nbsp;&nbsp;&nbsp;&nbsp;根据每个计算符号来计算对应行的值<br />
&nbsp;&nbsp;&nbsp;&nbsp;"根据整个公式&nbsp;&nbsp;整合所有对应的计算字符串&nbsp;&nbsp;利用对应的function&nbsp;&nbsp;计算出对应的值<br />
&nbsp;&nbsp;&nbsp;&nbsp;last&nbsp;=&nbsp;sy-index&nbsp;-&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;tp_char&nbsp;=&nbsp;p_formula+last(1)&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;tp_char&nbsp;CO&nbsp;'0123456789'&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"为数字<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;l_row&nbsp;tp_char&nbsp;INTO&nbsp;l_row&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;tp_char&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;tp_char&nbsp;CO&nbsp;'+-*/'&nbsp;OR&nbsp;sy-index&nbsp;=&nbsp;formula_len&nbsp;."为计算符号<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHIFT&nbsp;l_row&nbsp;RIGHT&nbsp;DELETING&nbsp;TRAILING&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OVERLAY&nbsp;l_row&nbsp;WITH&nbsp;'000'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;wa_dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_dmbtr&nbsp;INTO&nbsp;wa_dmbtr&nbsp;WITH&nbsp;KEY&nbsp;zrow&nbsp;=&nbsp;l_row&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:tp_value&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tp_value&nbsp;=&nbsp;wa_dmbtr-hslvt&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CLOI_PUT_SIGN_IN_FRONT'&nbsp;&nbsp;&nbsp;"负数负号前置<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;=&nbsp;tp_value.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;tp_hslvt&nbsp;'('&nbsp;tp_value&nbsp;')'&nbsp;&nbsp;tp_char&nbsp;INTO&nbsp;tp_hslvt&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:tp_value&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tp_value&nbsp;=&nbsp;wa_dmbtr-dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CLOI_PUT_SIGN_IN_FRONT'&nbsp;&nbsp;&nbsp;"负数负号前置<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;=&nbsp;tp_value.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;tp_dmbtr&nbsp;'('&nbsp;tp_value&nbsp;')'&nbsp;&nbsp;tp_char&nbsp;INTO&nbsp;tp_dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;tp_hslvt&nbsp;'(0)'&nbsp;&nbsp;tp_char&nbsp;INTO&nbsp;tp_hslvt&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;tp_dmbtr&nbsp;'(0)'&nbsp;&nbsp;tp_char&nbsp;INTO&nbsp;tp_dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;l_row&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDDO.<br />
<br />
&nbsp;&nbsp;IF&nbsp;tp_hslvt&nbsp;&lt;&gt;&nbsp;''&nbsp;&nbsp;.&nbsp;&nbsp;"计算期初<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;l_value&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CHECK_FORMULA'&nbsp;&nbsp;&nbsp;"判断整合的公司是否符合function的计算规则<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formula&nbsp;=&nbsp;tp_hslvt.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'EVAL_FORMULA'&nbsp;&nbsp;&nbsp;&nbsp;"根据整合字符窜计算出对应的值<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formula&nbsp;=&nbsp;tp_hslvt<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;&nbsp;&nbsp;=&nbsp;l_value.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_hslvt&nbsp;=&nbsp;l_value&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;tp_dmbtr&nbsp;&lt;&gt;&nbsp;''&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;"计算期末<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;l_value&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CHECK_FORMULA'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formula&nbsp;=&nbsp;tp_dmbtr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'EVAL_FORMULA'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formula&nbsp;=&nbsp;tp_dmbtr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;&nbsp;&nbsp;=&nbsp;l_value.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_dmbtr&nbsp;=&nbsp;l_value&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;OUTPUT_EXCEL<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM output_excel TABLES pt_table TYPE STANDARD TABLE. "输出对应内容到excel<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;PERFORM&nbsp;GET_EXCEL_MODLE.<br />
*&nbsp;&nbsp;CHECK&nbsp;G_EXCELNAME&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*下载模板<br />
<br />
*&nbsp;&nbsp;PERFORM&nbsp;frm_item_data&nbsp;.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;l_fullpath&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;l_path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;l_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;string.<br />
   </div>
   <div class="codeComment">
*&nbsp;用户选择保存路径<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;frm_get_fullpath&nbsp;CHANGING&nbsp;l_fullpath&nbsp;l_path&nbsp;l_name.<br />
   </div>
   <div class="codeComment">
*&nbsp;路径为空则退出<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;l_fullpath&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'用户取消操作'&nbsp;TYPE&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;PERFORM&nbsp;frm_crt_excel&nbsp;USING&nbsp;l_fullpath&nbsp;l_path.<br />
   </div>
   <div class="codeComment">
*<br />
*&nbsp;&nbsp;PERFORM&nbsp;CREATE_OLEOBJ.<br />
*&nbsp;&nbsp;PERFORM&nbsp;SET_EXCELDATA&nbsp;&nbsp;TABLES&nbsp;&nbsp;PT_TABLE.<br />
*&nbsp;&nbsp;PERFORM&nbsp;FRM_DISPLAY_SETING.<br />
*&nbsp;"注销创建的对象<br />
*&nbsp;&nbsp;FREE&nbsp;OBJECT&nbsp;GV_EXCELOBJ.<br />
*&nbsp;&nbsp;PERFORM&nbsp;EXCEL_QUIT&nbsp;.<br />
   </div>
   <div class="code">
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_EXCEL_MODLE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM get_excel_modle .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;l_objdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;wwwdatatab,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_mime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;w3mime,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_filename&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_fullpath&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;string&nbsp;&nbsp;VALUE&nbsp;'D:\',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;string&nbsp;&nbsp;VALUE&nbsp;'D:\',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_destination&nbsp;LIKE&nbsp;rlgrap-filename,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_objnam&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_rc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;sy-subrc,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_errtxt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;string.<br />
&nbsp;&nbsp;DATA:&nbsp;l_dest&nbsp;LIKE&nbsp;sapb-sappfad.<br />
&nbsp;&nbsp;IF&nbsp;sy-langu&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;g_butxt&nbsp;'_资产负债表'&nbsp;INTO&nbsp;l_filename.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;g_butxt&nbsp;'_Balance&nbsp;Sheet'&nbsp;INTO&nbsp;l_filename.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_gui_frontend_services=&gt;file_save_dialog&nbsp;&nbsp;"获取你需要保存的文件路径<br />
&nbsp;&nbsp;&nbsp;&nbsp;"调用保存对话框<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_extension&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'XLS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_file_name&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_filename<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial_directory&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'D:\'<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_filename<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_path<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fullpath&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_fullpath<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntl_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_no_gui&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_supported_by_gui&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0&nbsp;AND&nbsp;l_fullpath&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;l_destination&nbsp;=&nbsp;l_fullpath.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;relid&nbsp;objid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;wwwdata<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;l_objdata<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UP&nbsp;TO&nbsp;1&nbsp;ROWS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;&nbsp;srtf2&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;relid&nbsp;=&nbsp;'MI'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;objid&nbsp;=&nbsp;'ZFIB_010'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDSELECT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'DOWNLOAD_WEB_OBJECT'&nbsp;&nbsp;"下载你上传到服务器的对应模版<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_objdata<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination&nbsp;=&nbsp;l_destination<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_rc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_dest.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;l_rc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-langu&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'模板文件：'&nbsp;l_objdata+2(12)&nbsp;'下载失败'&nbsp;INTO&nbsp;l_errtxt.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'Template&nbsp;File:'&nbsp;l_objdata+2(12)&nbsp;'Download&nbsp;Failed'&nbsp;INTO&nbsp;l_errtxt.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;l_errtxt&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;g_excelname&nbsp;=&nbsp;l_destination.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CREATE_OLEOBJ<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM create_oleobj . "ABAP OLE 创建并打开一个EXCEL实例<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;G_EXCEL&nbsp;'EXCEL.APPLICATION'.<br />
*&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;G_EXCEL&nbsp;&nbsp;'VISIBLE'&nbsp;=&nbsp;1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"不显示窗口<br />
*&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;G_EXCEL&nbsp;&nbsp;'SCREENUPDATING'&nbsp;=&nbsp;0.&nbsp;&nbsp;"关闭刷新,增加填数据的速度<br />
*<br />
*<br />
*&nbsp;&nbsp;GET&nbsp;PROPERTY&nbsp;OF&nbsp;G_EXCEL&nbsp;'WORKBOOKS'&nbsp;=&nbsp;G_BOOKS.<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;G_BOOKS&nbsp;'OPEN'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;=&nbsp;G_EXCELNAME.<br />
*<br />
*<br />
*&nbsp;&nbsp;GET&nbsp;PROPERTY&nbsp;OF&nbsp;G_EXCEL&nbsp;'WORKSHEETS'&nbsp;=&nbsp;G_SHEETS&nbsp;.<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;G_EXCEL&nbsp;'WORKSHEETS'&nbsp;=&nbsp;G_SHEETS<br />
*&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;.<br />
*<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;G_SHEETS&nbsp;'ACTIVATE'.<br />
*<br />
*&nbsp;&nbsp;GET&nbsp;PROPERTY&nbsp;OF&nbsp;G_EXCEL&nbsp;'ACTIVESHEET'&nbsp;=&nbsp;G_SHEETS.<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="code">
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_EXCELDATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*FORM&nbsp;SET_EXCELDATA&nbsp;&nbsp;TABLES&nbsp;&nbsp;PT_TABLE&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;.&nbsp;"LIKE&nbsp;&nbsp;GTY_SHOW_DATA&nbsp;.<br />
*<br />
*&nbsp;&nbsp;DATA:&nbsp;TP_DATE&nbsp;TYPE&nbsp;C&nbsp;LENGTH&nbsp;20,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TODAY&nbsp;&nbsp;&nbsp;LIKE&nbsp;SY-DATUM.<br />
*&nbsp;&nbsp;DATA:&nbsp;L_ROW&nbsp;&nbsp;TYPE&nbsp;I&nbsp;.<br />
*<br />
*&nbsp;&nbsp;FIELD-SYMBOLS:&lt;DATA&gt;&nbsp;TYPE&nbsp;ANY&nbsp;.<br />
*&nbsp;&nbsp;DATA:&nbsp;L_STR&nbsp;TYPE&nbsp;STRING.<br />
*<br />
*&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;T_SENDERLINE,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINE(4096)&nbsp;TYPE&nbsp;C,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;T_SENDERLINE&nbsp;.<br />
*&nbsp;&nbsp;TYPES:T_SENDER&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;T_SENDERLINE&nbsp;.<br />
*&nbsp;&nbsp;DATA:&nbsp;IT_EXCEL_TAB&nbsp;&nbsp;TYPE&nbsp;T_SENDER,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WS_EXCEL_LINE&nbsp;TYPE&nbsp;T_SENDERLINE.<br />
*&nbsp;&nbsp;DATA:&nbsp;L_SEPARATOR&nbsp;TYPE&nbsp;C.<br />
*&nbsp;&nbsp;CLASS&nbsp;CL_ABAP_CHAR_UTILITIES&nbsp;DEFINITION&nbsp;LOAD.<br />
*&nbsp;&nbsp;L_SEPARATOR&nbsp;=&nbsp;CL_ABAP_CHAR_UTILITIES=&gt;HORIZONTAL_TAB.<br />
*<br />
*<br />
*&nbsp;&nbsp;DATA:&nbsp;LT_SHOW_DATA&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;SHOW_DATA.<br />
*<br />
*&nbsp;&nbsp;REFRESH&nbsp;LT_SHOW_DATA[]&nbsp;.<br />
*<br />
*&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;PT_TABLE[]&nbsp;TO&nbsp;LT_SHOW_DATA&nbsp;.<br />
*<br />
*<br />
*&nbsp;&nbsp;IF&nbsp;SY-LANGU&nbsp;=&nbsp;'1'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'编制单位：'&nbsp;G_BUTXT&nbsp;INTO&nbsp;G_BUTXT.<br />
*&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'Company&nbsp;Name:'&nbsp;G_BUTXT&nbsp;INTO&nbsp;G_BUTXT.<br />
*&nbsp;&nbsp;ENDIF.<br />
*<br />
*<br />
*&nbsp;&nbsp;CONCATENATE&nbsp;P_RYEAR&nbsp;P_RPMAX+1(2)&nbsp;'01'&nbsp;INTO&nbsp;TODAY&nbsp;.<br />
*&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'LAST_DAY_OF_MONTHS'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DAY_IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;TODAY&nbsp;"输入一个完整的日期<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LAST_DAY_OF_MONTH&nbsp;=&nbsp;TODAY&nbsp;"输出:一个完整的日期,天数是这个月的最后一天<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DAY_IN_NO_DATE&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
*&nbsp;&nbsp;IF&nbsp;SY-LANGU&nbsp;=&nbsp;'1'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'日期：'&nbsp;TODAY+0(4)&nbsp;'年'&nbsp;TODAY+4(2)&nbsp;'月'&nbsp;TODAY+6(2)&nbsp;'日'&nbsp;INTO&nbsp;TP_DATE.<br />
*&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'Date：'&nbsp;TODAY+0(4)&nbsp;'Year'&nbsp;TODAY+4(2)&nbsp;'Month'&nbsp;TODAY+6(2)&nbsp;'Day'&nbsp;INTO&nbsp;TP_DATE.<br />
*&nbsp;&nbsp;ENDIF.<br />
**&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;3&nbsp;1&nbsp;G_BUTXT&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;2&nbsp;4&nbsp;TP_DATE&nbsp;''&nbsp;''&nbsp;.<br />
*<br />
**&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;2&nbsp;&nbsp;4&nbsp;&nbsp;TP_DATE&nbsp;&nbsp;0.<br />
*&nbsp;&nbsp;DATA:GV_I_ROW&nbsp;TYPE&nbsp;I&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;&nbsp;GV_I_ROW&nbsp;=&nbsp;&nbsp;3&nbsp;.<br />
*&nbsp;&nbsp;BREAK-POINT&nbsp;.<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_SHOW_DATA&nbsp;INTO&nbsp;DATA(PS_TABLE)&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;"循环整个内表&nbsp;&nbsp;输入得到的资产负债数据到excel中&nbsp;&nbsp;&nbsp;整合复制粘贴法的内表中<br />
*&nbsp;&nbsp;&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;=&nbsp;GV_I_ROW&nbsp;&nbsp;+&nbsp;1&nbsp;&nbsp;.<br />
*<br />
*<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;PS_TABLE-ZTEXT&nbsp;&nbsp;0.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;PS_TABLE-DMBTR&nbsp;&nbsp;0&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;PS_TABLE-HSLVT&nbsp;0.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;PS_TABLE-ZTEXT1&nbsp;0.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;PS_TABLE-DMBTR1&nbsp;0.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;PS_TABLE-HSLVT1&nbsp;0.<br />
*<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;1&nbsp;PS_TABLE-ZTEXT&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;2&nbsp;PS_TABLE-DMBTR&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;3&nbsp;PS_TABLE-HSLVT&nbsp;''&nbsp;''&nbsp;.<br />
***&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;4&nbsp;PS_TABLE-ZROW1&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;4&nbsp;PS_TABLE-ZTEXT1&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;5&nbsp;PS_TABLE-DMBTR1&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;6&nbsp;PS_TABLE-HSLVT1&nbsp;''&nbsp;''&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&nbsp;PS_TABLE&nbsp;.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;NEW&nbsp;ZCOLUMN&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:IT_EXCEL_TAB[]&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDAT&nbsp;.<br />
*<br />
**--特殊要求<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DMBTR-ZCOLUMN&nbsp;=&nbsp;'B'&nbsp;AND&nbsp;GS_DMBTR-ZROW&nbsp;&lt;&gt;&nbsp;'056'&nbsp;.&nbsp;&nbsp;&nbsp;"输出时正负的限制<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DMBTR-HSLVT&nbsp;=&nbsp;(&nbsp;-1&nbsp;)&nbsp;*&nbsp;GS_DMBTR-HSLVT&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DMBTR-DMBTR&nbsp;=&nbsp;(&nbsp;-1&nbsp;)&nbsp;*&nbsp;GS_DMBTR-DMBTR&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;WS_EXCEL_LINE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DO&nbsp;2&nbsp;TIMES.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;(&nbsp;SY-INDEX&nbsp;+&nbsp;2&nbsp;)&nbsp;OF&nbsp;STRUCTURE&nbsp;GS_DMBTR&nbsp;TO&nbsp;&lt;DATA&gt;&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_STR&nbsp;=&nbsp;&lt;DATA&gt;&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"金额字段负号前置<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CLOI_PUT_SIGN_IN_FRONT'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE&nbsp;=&nbsp;L_STR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WS_EXCEL_LINE&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;WS_EXCEL_LINE&nbsp;L_STR&nbsp;INTO&nbsp;WS_EXCEL_LINE&nbsp;SEPARATED&nbsp;BY&nbsp;L_SEPARATOR&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;WS_EXCEL_LINE&nbsp;L_STR&nbsp;INTO&nbsp;WS_EXCEL_LINE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:L_STR&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;WS_EXCEL_LINE&nbsp;L_STR&nbsp;INTO&nbsp;WS_EXCEL_LINE&nbsp;SEPARATED&nbsp;BY&nbsp;L_SEPARATOR&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDDO.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;ws_excel_line&nbsp;=&nbsp;ws_excel_line+1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WS_EXCEL_LINE&nbsp;TO&nbsp;IT_EXCEL_TAB.<br />
<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DMBTR-ZROW&nbsp;=&nbsp;'017'&nbsp;OR&nbsp;GS_DMBTR-ZROW&nbsp;=&nbsp;'028'&nbsp;OR&nbsp;GS_DMBTR-ZROW&nbsp;=&nbsp;'029'&nbsp;OR&nbsp;GS_DMBTR-ZROW&nbsp;=&nbsp;'053'&nbsp;.&nbsp;&nbsp;"为了满足输出模版&nbsp;&nbsp;在这些行的时候跳行<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WS_EXCEL_LINE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WS_EXCEL_LINE&nbsp;TO&nbsp;IT_EXCEL_TAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GS_DMBTR-ZROW&nbsp;=&nbsp;'013'&nbsp;OR&nbsp;GS_DMBTR-ZROW&nbsp;=&nbsp;'044'&nbsp;&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WS_EXCEL_LINE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WS_EXCEL_LINE&nbsp;TO&nbsp;IT_EXCEL_TAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WS_EXCEL_LINE&nbsp;TO&nbsp;IT_EXCEL_TAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;END&nbsp;OF&nbsp;ZCOLUMN&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DMBTR-ZCOLUMN&nbsp;=&nbsp;'A'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_CLIPBOARD_TO_EXCEL&nbsp;TABLES&nbsp;IT_EXCEL_TAB&nbsp;USING&nbsp;6&nbsp;3&nbsp;48&nbsp;4&nbsp;.&nbsp;&nbsp;"输出到excel<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GS_DMBTR-ZCOLUMN&nbsp;=&nbsp;'B'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_CLIPBOARD_TO_EXCEL&nbsp;TABLES&nbsp;IT_EXCEL_TAB&nbsp;USING&nbsp;6&nbsp;7&nbsp;48&nbsp;8&nbsp;.&nbsp;&nbsp;"输出到excel<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDAT&nbsp;.<br />
<br />
<br />
<br />
*<br />
*&nbsp;&nbsp;DATA:&nbsp;LV_COUNT&nbsp;TYPE&nbsp;I.<br />
**--A<br />
*&nbsp;&nbsp;REFRESH&nbsp;IT_EXCEL_TAB.<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_SHOW_DATA&nbsp;INTO&nbsp;GS_SHOW_DATA&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;"循环整个内表输入得到的资产负债数据到excel中&nbsp;&nbsp;&nbsp;整合复制粘贴法的内表中<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;WS_EXCEL_LINE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DO&nbsp;2&nbsp;TIMES.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;(&nbsp;SY-INDEX&nbsp;+&nbsp;2&nbsp;)&nbsp;OF&nbsp;STRUCTURE&nbsp;GS_SHOW_DATA&nbsp;TO&nbsp;&lt;DATA&gt;&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_STR&nbsp;=&nbsp;&lt;DATA&gt;&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"金额字段负号前置<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CLOI_PUT_SIGN_IN_FRONT'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE&nbsp;=&nbsp;L_STR.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WS_EXCEL_LINE&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;WS_EXCEL_LINE&nbsp;L_STR&nbsp;INTO&nbsp;WS_EXCEL_LINE&nbsp;SEPARATED&nbsp;BY&nbsp;L_SEPARATOR&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WS_EXCEL_LINE&nbsp;=&nbsp;&nbsp;L_STR&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:L_STR&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDDO.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WS_EXCEL_LINE&nbsp;TO&nbsp;IT_EXCEL_TAB.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
*<br />
*&nbsp;&nbsp;LV_COUNT&nbsp;=&nbsp;LINES(&nbsp;GT_SHOW_DATA[]&nbsp;)&nbsp;&nbsp;+&nbsp;4.<br />
*&nbsp;&nbsp;PERFORM&nbsp;FRM_CLIPBOARD_TO_EXCEL&nbsp;TABLES&nbsp;IT_EXCEL_TAB&nbsp;USING&nbsp;5&nbsp;3&nbsp;LV_COUNT&nbsp;4&nbsp;.&nbsp;&nbsp;"输出到excel<br />
*<br />
**--B<br />
*&nbsp;&nbsp;REFRESH&nbsp;IT_EXCEL_TAB.<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_SHOW_DATA&nbsp;INTO&nbsp;GS_SHOW_DATA&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;"循环整个内表输入得到的资产负债数据到excel中&nbsp;&nbsp;&nbsp;整合复制粘贴法的内表中<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;WS_EXCEL_LINE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DO&nbsp;2&nbsp;TIMES.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;(&nbsp;SY-INDEX&nbsp;+&nbsp;6&nbsp;)&nbsp;OF&nbsp;STRUCTURE&nbsp;GS_SHOW_DATA&nbsp;TO&nbsp;&lt;DATA&gt;&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;DATA&gt;&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_STR&nbsp;=&nbsp;&lt;DATA&gt;&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"金额字段负号前置<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CLOI_PUT_SIGN_IN_FRONT'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE&nbsp;=&nbsp;L_STR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_STR&nbsp;=&nbsp;'@'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WS_EXCEL_LINE&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;WS_EXCEL_LINE&nbsp;L_STR&nbsp;INTO&nbsp;WS_EXCEL_LINE&nbsp;SEPARATED&nbsp;BY&nbsp;L_SEPARATOR&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPLACE&nbsp;'@'&nbsp;WITH&nbsp;'&nbsp;'&nbsp;INTO&nbsp;WS_EXCEL_LINE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;WS_EXCEL_LINE&nbsp;L_STR&nbsp;INTO&nbsp;WS_EXCEL_LINE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPLACE&nbsp;'@'&nbsp;WITH&nbsp;'&nbsp;'&nbsp;INTO&nbsp;WS_EXCEL_LINE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:L_STR&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;WS_EXCEL_LINE&nbsp;L_STR&nbsp;INTO&nbsp;WS_EXCEL_LINE&nbsp;SEPARATED&nbsp;BY&nbsp;L_SEPARATOR&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPLACE&nbsp;'@'&nbsp;WITH&nbsp;'&nbsp;'&nbsp;INTO&nbsp;WS_EXCEL_LINE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDDO.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WS_EXCEL_LINE&nbsp;TO&nbsp;IT_EXCEL_TAB.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
*&nbsp;&nbsp;PERFORM&nbsp;FRM_CLIPBOARD_TO_EXCEL&nbsp;TABLES&nbsp;IT_EXCEL_TAB&nbsp;USING&nbsp;5&nbsp;7&nbsp;LV_COUNT&nbsp;8&nbsp;.&nbsp;&nbsp;"输出到excel<br />
<br />
<br />
<br />
<br />
*ENDFORM.<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;EXCEL_QUIT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM excel_quit .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;G_EXCEL&nbsp;'SCREENUPDATING'&nbsp;=&nbsp;1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"打开刷新<br />
*<br />
*&nbsp;&nbsp;GET&nbsp;PROPERTY&nbsp;OF&nbsp;G_EXCEL&nbsp;'ActiveWorkbook'&nbsp;=&nbsp;G_BOOKS.<br />
*<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;G_BOOKS&nbsp;'SAVE'.<br />
*<br />
**&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;g_excel&nbsp;'QUIT'.<br />
*<br />
*&nbsp;&nbsp;FREE&nbsp;OBJECT&nbsp;G_BOOKS.<br />
**&nbsp;&nbsp;FREE&nbsp;OBJECT&nbsp;g_excel.<br />
<br />
   </div>
   <div class="code">
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_CELL<br />
*&---------------------------------------------------------------------*<br />
<br />
   </div>
   <div class="code">
FORM fill_cell USING a b c d e.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;g_excel&nbsp;'CELLS'&nbsp;&nbsp;=&nbsp;g_cell&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单元格位置<br />
&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;a<br />
&nbsp;&nbsp;&nbsp;&nbsp;#2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;b.<br />
&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;g_cell&nbsp;'VALUE'&nbsp;=&nbsp;c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单元格内容<br />
<br />
&nbsp;&nbsp;GET&nbsp;PROPERTY&nbsp;OF&nbsp;g_cell&nbsp;'FONT'&nbsp;=&nbsp;g_font.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;g_cell&nbsp;'FONT'&nbsp;=&nbsp;g_font.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;g_font&nbsp;'BOLD'&nbsp;=&nbsp;d&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"字体是否加粗<br />
&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;g_font&nbsp;'SIZE'&nbsp;=&nbsp;e&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"字体大小<br />
&nbsp;&nbsp;FREE&nbsp;OBJECT&nbsp;g_cell&nbsp;.<br />
&nbsp;&nbsp;FREE&nbsp;OBJECT&nbsp;g_font&nbsp;.<br />
ENDFORM. " fill_cell<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_CLIPBOARD_TO_EXCEL<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_CLIPBOARD_TO_EXCEL<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_clipboard_to_excel TABLES p_excel_table USING s_row s_col e_row e_col .<br />
<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;t_senderline,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line(4096)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;t_senderline&nbsp;.<br />
&nbsp;&nbsp;TYPES:t_sender&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;t_senderline&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;it_excel_tab&nbsp;&nbsp;TYPE&nbsp;t_sender,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ws_excel_line&nbsp;TYPE&nbsp;t_senderline.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;l_range&nbsp;&nbsp;&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_cell_01&nbsp;TYPE&nbsp;ole2_object,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_cell_02&nbsp;TYPE&nbsp;ole2_object.<br />
&nbsp;&nbsp;DATA:&nbsp;l_rc&nbsp;TYPE&nbsp;i.<br />
<br />
&nbsp;&nbsp;CLEAR:it_excel_tab[]&nbsp;.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;p_excel_table[]&nbsp;TO&nbsp;it_excel_tab[]&nbsp;.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_gui_frontend_services=&gt;clipboard_export&nbsp;&nbsp;&nbsp;&nbsp;"此处用到的是复制粘贴法&nbsp;&nbsp;&nbsp;&nbsp;输出内容到excel<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_excel_tab[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_rc<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntl_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_no_gui&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_supported_by_gui&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;g_sheets&nbsp;'Cells'&nbsp;=&nbsp;l_cell_01<br />
&nbsp;&nbsp;EXPORTING&nbsp;#1&nbsp;=&nbsp;s_row&nbsp;#2&nbsp;=&nbsp;s_col.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;g_sheets&nbsp;'Cells'&nbsp;=&nbsp;l_cell_02<br />
&nbsp;&nbsp;EXPORTING&nbsp;#1&nbsp;=&nbsp;e_row&nbsp;#2&nbsp;=&nbsp;e_col.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;g_sheets&nbsp;'Range'&nbsp;=&nbsp;l_range<br />
&nbsp;&nbsp;EXPORTING&nbsp;#1&nbsp;=&nbsp;l_cell_01&nbsp;#2&nbsp;=&nbsp;l_cell_02.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;l_range&nbsp;'SELECT'.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;g_sheets&nbsp;'PASTE'.<br />
<br />
&nbsp;&nbsp;FREE&nbsp;OBJECT:&nbsp;l_range,&nbsp;l_cell_01,l_cell_02.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SUB_AUTHORITY_CHECK<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM sub_authority_check .<br />
<br />
&nbsp;&nbsp;AUTHORITY-CHECK&nbsp;OBJECT&nbsp;'F_BKPF_BUK'<br />
&nbsp;&nbsp;ID&nbsp;'BUKRS'&nbsp;FIELD&nbsp;p_bukrs<br />
&nbsp;&nbsp;ID&nbsp;'ACTVT'&nbsp;FIELD&nbsp;'03'.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;Implement&nbsp;a&nbsp;suitable&nbsp;exception&nbsp;handling&nbsp;here<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'没有查看该公司的权限'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SUB_SHOW_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM sub_show_data .<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;frm_set_fieldcat&nbsp;.<br />
&nbsp;&nbsp;PERFORM&nbsp;frm_set_layout&nbsp;.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY_LVC'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_callback_program&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-repid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_callback_pf_status_set&nbsp;=&nbsp;'ALV_PF_STATUS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_callback_user_command&nbsp;&nbsp;=&nbsp;'ALV_USER_COMMAND'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_callback_top_of_page&nbsp;&nbsp;&nbsp;=&nbsp;'ALV_TOP_OF_PAGE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_save&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'A'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_sort_lvc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_alv_sort[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_layout_lvc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gs_layout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_fieldcat_lvc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_fieldcatalog[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t_outtab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_show_data[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;Implement&nbsp;suitable&nbsp;error&nbsp;handling&nbsp;here<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SUB_CREATE_SHOW<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM sub_create_show .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;lt_fit001&nbsp;LIKE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;zfit_003,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fit001&nbsp;LIKE&nbsp;zfit_003.<br />
<br />
&nbsp;&nbsp;lt_fit001[]&nbsp;=&nbsp;gt_fit001[].<br />
&nbsp;&nbsp;DELETE&nbsp;lt_fit001&nbsp;WHERE&nbsp;zcolumn&nbsp;NE&nbsp;'A'.<br />
&nbsp;&nbsp;SORT&nbsp;lt_fit001&nbsp;BY&nbsp;zrow.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;lt_fit001&nbsp;COMPARING&nbsp;zrow.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_fit001&nbsp;INTO&nbsp;ls_fit001&nbsp;WHERE&nbsp;zcolumn&nbsp;=&nbsp;'A'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_show_data&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS&nbsp;WITH&nbsp;KEY&nbsp;zrow&nbsp;=&nbsp;ls_fit001-zrow.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gs_show_data&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_dmbtr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_fit001-zjfbs&nbsp;=&nbsp;''&nbsp;AND&nbsp;ls_fit001-zdfbs&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_dmbtr&nbsp;INTO&nbsp;gs_dmbtr&nbsp;WITH&nbsp;KEY&nbsp;zcolumn&nbsp;=&nbsp;ls_fit001-zcolumn&nbsp;zrow&nbsp;=&nbsp;ls_fit001-zrow.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-zcolumn&nbsp;=&nbsp;gs_dmbtr-zcolumn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-zrow&nbsp;=&nbsp;gs_dmbtr-zrow.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-ztext&nbsp;=&nbsp;ls_fit001-ztext&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-hslvt&nbsp;=&nbsp;gs_dmbtr-hslvt&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-dmbtr&nbsp;=&nbsp;gs_dmbtr-dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_show_data&nbsp;TO&nbsp;gt_show_data&nbsp;.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;lv_index&nbsp;TYPE&nbsp;i.<br />
<br />
&nbsp;&nbsp;lt_fit001[]&nbsp;=&nbsp;gt_fit001[].<br />
&nbsp;&nbsp;DELETE&nbsp;lt_fit001&nbsp;WHERE&nbsp;zcolumn&nbsp;NE&nbsp;'B'.<br />
&nbsp;&nbsp;SORT&nbsp;lt_fit001&nbsp;BY&nbsp;zrow.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;lt_fit001&nbsp;COMPARING&nbsp;zrow.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_fit001&nbsp;INTO&nbsp;ls_fit001.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;lv_index.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_index&nbsp;=&nbsp;sy-tabix.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_show_data&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS&nbsp;WITH&nbsp;KEY&nbsp;zrow&nbsp;=&nbsp;ls_fit001-zrow.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_show_data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_show_data&nbsp;INTO&nbsp;gs_show_data&nbsp;INDEX&nbsp;lv_index.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_dmbtr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_fit001-zjfbs&nbsp;=&nbsp;''&nbsp;AND&nbsp;ls_fit001-zdfbs&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_dmbtr&nbsp;INTO&nbsp;gs_dmbtr&nbsp;WITH&nbsp;KEY&nbsp;zcolumn&nbsp;=&nbsp;ls_fit001-zcolumn&nbsp;zrow&nbsp;=&nbsp;ls_fit001-zrow.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-zcolumn&nbsp;=&nbsp;gs_dmbtr-zcolumn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-zrow1&nbsp;=&nbsp;gs_dmbtr-zrow.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-ztext1&nbsp;=&nbsp;ls_fit001-ztext&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-hslvt1&nbsp;=&nbsp;0&nbsp;-&nbsp;gs_dmbtr-hslvt&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-dmbtr1&nbsp;=&nbsp;0&nbsp;-&nbsp;gs_dmbtr-dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_show_data&nbsp;FROM&nbsp;gs_show_data&nbsp;INDEX&nbsp;lv_index.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_dmbtr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_fit001-zjfbs&nbsp;=&nbsp;''&nbsp;AND&nbsp;ls_fit001-zdfbs&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_dmbtr&nbsp;INTO&nbsp;gs_dmbtr&nbsp;WITH&nbsp;KEY&nbsp;zcolumn&nbsp;=&nbsp;ls_fit001-zcolumn&nbsp;zrow&nbsp;=&nbsp;ls_fit001-zrow.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-zcolumn&nbsp;=&nbsp;gs_dmbtr-zcolumn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-zrow1&nbsp;=&nbsp;gs_dmbtr-zrow.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-ztext1&nbsp;=&nbsp;ls_fit001-ztext&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-hslvt1&nbsp;=&nbsp;0&nbsp;-&nbsp;gs_dmbtr-hslvt&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_show_data-dmbtr1&nbsp;=&nbsp;0&nbsp;-&nbsp;gs_dmbtr-dmbtr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_show_data&nbsp;TO&nbsp;gt_show_data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_SET_FIELDCAT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_set_fieldcat .<br />
<br />
&nbsp;&nbsp;DEFINE&nbsp;bulid_fieldlog.<br />
&nbsp;&nbsp;&nbsp;&nbsp;g_pos&nbsp;=&nbsp;g_pos&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-col_pos&nbsp;=&nbsp;g_pos.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-fieldname&nbsp;=&nbsp;&1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-coltext&nbsp;=&nbsp;&2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-outputlen&nbsp;=&nbsp;&3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-ref_table&nbsp;&nbsp;=&nbsp;&4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-ref_field&nbsp;=&nbsp;&5.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-edit&nbsp;=&nbsp;&6.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-key&nbsp;=&nbsp;&7.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-checkbox&nbsp;=&nbsp;&8&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-lzero&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-no_zero&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-lowercase&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;g_pos&nbsp;=&nbsp;1&nbsp;OR&nbsp;g_pos&nbsp;=&nbsp;4&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-just&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_fieldcatalog-just&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fieldcatalog&nbsp;TO&nbsp;gt_fieldcatalog.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fieldcatalog.<br />
&nbsp;&nbsp;END-OF-DEFINITION.<br />
<br />
&nbsp;&nbsp;FREE&nbsp;:&nbsp;gt_fieldcatalog.<br />
&nbsp;&nbsp;CLEAR:&nbsp;g_pos.<br />
&nbsp;&nbsp;IF&nbsp;sy-langu&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bulid_fieldlog:<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZTEXT'&nbsp;&nbsp;&nbsp;&nbsp;'资产'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'DMBTR'&nbsp;&nbsp;&nbsp;&nbsp;'期末余额'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'HSLVT'&nbsp;&nbsp;&nbsp;&nbsp;'年初余额'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZTEXT1'&nbsp;&nbsp;&nbsp;&nbsp;'负债及所有者权益'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'DMBTR1'&nbsp;&nbsp;&nbsp;&nbsp;'期末余额'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;'HSLVT1'&nbsp;&nbsp;&nbsp;&nbsp;'年初余额'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bulid_fieldlog:<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZTEXT'&nbsp;&nbsp;&nbsp;&nbsp;'Assets'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'DMBTR'&nbsp;&nbsp;&nbsp;&nbsp;'Closing&nbsp;Balance'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'HSLVT'&nbsp;&nbsp;&nbsp;&nbsp;'Opening&nbsp;Balance'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZTEXT1'&nbsp;&nbsp;&nbsp;&nbsp;'Liabilities&nbsp;and&nbsp;Equity'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'DMBTR1'&nbsp;&nbsp;&nbsp;&nbsp;'Closing&nbsp;Balance'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;'HSLVT1'&nbsp;&nbsp;&nbsp;&nbsp;'Opening&nbsp;Balance'&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_SET_LAYOUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_set_layout .<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;gs_layout.<br />
&nbsp;&nbsp;gs_layout-box_fname&nbsp;=&nbsp;'SLBOX'.<br />
&nbsp;&nbsp;gs_layout-zebra&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;gs_layout-sel_mode&nbsp;=&nbsp;'B'&nbsp;."'B'.<br />
&nbsp;&nbsp;gs_layout-cwidth_opt&nbsp;=&nbsp;'X'.&nbsp;&nbsp;"优化列宽<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;gs_layout-KEYHOT&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;gs_layout-stylefname&nbsp;=&nbsp;'CELLTAB'.<br />
<br />
   </div>
   <div class="code">
ENDFORM.<br />
<br />
<br />
FORM alv_top_of_page.<br />
&nbsp;&nbsp;DATA:&nbsp;l_text&nbsp;TYPE&nbsp;string&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;g_butxt.<br />
&nbsp;&nbsp;IF&nbsp;s_prctr&nbsp;IS&nbsp;INITIAL&nbsp;OR&nbsp;s_prctr-high&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;butxt<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;g_butxt<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;t001<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;bukrs&nbsp;=&nbsp;p_bukrs&nbsp;.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;ktext<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;g_butxt<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;cepct<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;prctr&nbsp;=&nbsp;s_prctr-low.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;IF&nbsp;sy-langu&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;g_butxt&nbsp;'--资产负债表'&nbsp;INTO&nbsp;l_text&nbsp;.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;g_butxt&nbsp;'--Balance&nbsp;Sheet'&nbsp;INTO&nbsp;l_text&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;gs_header,gt_header[]&nbsp;.<br />
&nbsp;&nbsp;gs_header-typ&nbsp;=&nbsp;'H'&nbsp;.<br />
&nbsp;&nbsp;gs_header-info&nbsp;=&nbsp;l_text&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;gs_header&nbsp;TO&nbsp;gt_header&nbsp;.<br />
&nbsp;&nbsp;IF&nbsp;sy-langu&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'所属期：'&nbsp;p_ryear&nbsp;'-'&nbsp;p_rpmax+1(2)&nbsp;INTO&nbsp;l_text&nbsp;.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'Period:'&nbsp;p_ryear&nbsp;'-'&nbsp;p_rpmax+1(2)&nbsp;INTO&nbsp;l_text&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;gs_header&nbsp;.<br />
&nbsp;&nbsp;gs_header-typ&nbsp;=&nbsp;'S'&nbsp;.<br />
&nbsp;&nbsp;gs_header-info&nbsp;=&nbsp;l_text&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;gs_header&nbsp;TO&nbsp;gt_header&nbsp;.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;p_1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_zfit_024&nbsp;INTO&nbsp;DATA(ls_zfit_024)&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'保存日期：'&nbsp;ls_zfit_024-datum+0(4)&nbsp;'年'&nbsp;ls_zfit_024-datum+4(2)&nbsp;'月'&nbsp;ls_zfit_024-datum+6(2)&nbsp;'日'&nbsp;ls_zfit_024-uzeit+0(2)&nbsp;'时'&nbsp;ls_zfit_024-uzeit+2(2)&nbsp;'分'&nbsp;ls_zfit_024-uzeit+4(2)&nbsp;'秒'&nbsp;INTO&nbsp;l_text&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;CLEAR:&nbsp;gs_header&nbsp;.<br />
&nbsp;&nbsp;gs_header-typ&nbsp;=&nbsp;'S'&nbsp;.<br />
&nbsp;&nbsp;gs_header-info&nbsp;=&nbsp;l_text&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;gs_header&nbsp;TO&nbsp;gt_header&nbsp;.<br />
<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_COMMENTARY_WRITE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_list_commentary&nbsp;=&nbsp;gt_header[]<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_logo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ENJOYSAP_LOGO'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_END_OF_LIST_GRID&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_ALV_FORM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
ENDFORM .<br />
<br />
FORM alv_user_command USING p_ucomm LIKE sy-ucomm<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rs_selfield&nbsp;TYPE&nbsp;slis_selfield.<br />
&nbsp;&nbsp;DATA:&nbsp;l_name&nbsp;TYPE&nbsp;string&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;lr_grid&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;cl_gui_alv_grid.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_grid&nbsp;=&nbsp;lr_grid.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;lr_grid-&gt;check_changed_data.<br />
<br />
&nbsp;&nbsp;rs_selfield-refresh&nbsp;=&nbsp;'X'.&nbsp;&nbsp;"自动刷新<br />
&nbsp;&nbsp;rs_selfield-col_stable&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;rs_selfield-row_stable&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;p_ucomm&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'D_LOAD'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;output_excel&nbsp;TABLES&nbsp;gt_show_data&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BC'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;frm_update_data.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'&IC1'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"双击触发的事件<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;sub_rstgr_data&nbsp;USING&nbsp;rs_selfield&nbsp;.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDCASE.<br />
ENDFORM. "USER_COMMAND_ALV<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;set_pf_status<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AVL&nbsp;STATUS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM alv_pf_status USING rt_extab TYPE slis_t_extab.<br />
&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'GUI01'&nbsp;.<br />
ENDFORM. "set_pf_status<br />
<br />
FORM sub_rstgr_data USING rs_selfield TYPE slis_selfield .<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;gs_show_data&nbsp;.<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_show_data&nbsp;INTO&nbsp;gs_show_data&nbsp;INDEX&nbsp;rs_selfield-tabindex&nbsp;.<br />
&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;EQ&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;"仅在双击期末余额的时候下钻<br />
&nbsp;&nbsp;IF&nbsp;&nbsp;rs_selfield-fieldname&nbsp;=&nbsp;'DMBTR'&nbsp;OR&nbsp;rs_selfield-fieldname&nbsp;=&nbsp;'DMBTR1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;zi&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;&nbsp;&nbsp;zi&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;:&nbsp;ztextd&nbsp;TYPE&nbsp;&nbsp;zfit_003-ztext.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;rs_selfield-fieldname&nbsp;=&nbsp;'DMBTR'&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ztextd&nbsp;=&nbsp;gs_show_data-ztext.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;rs_selfield-fieldname&nbsp;=&nbsp;'DMBTR1'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ztextd&nbsp;=&nbsp;gs_show_data-ztext1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zi&nbsp;=&nbsp;-1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ztextd&nbsp;&lt;&gt;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RANGES:&nbsp;s_racct&nbsp;FOR&nbsp;faglflext-racct.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:s_racct[],gs_fit001.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_fit001&nbsp;INTO&nbsp;gs_fit001&nbsp;WITH&nbsp;KEY&nbsp;ztext&nbsp;=&nbsp;ztextd.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_fit001&nbsp;ASSIGNING&nbsp;&lt;gs_fit001&gt;&nbsp;WHERE&nbsp;&nbsp;zrow&nbsp;=&nbsp;gs_fit001-zrow."ZTEXT&nbsp;=&nbsp;ZTEXTD&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;&lt;&gt;&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-tsaknr&nbsp;=&nbsp;''&nbsp;.&nbsp;&nbsp;"根据配置整合科目范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_racct-sign&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_racct-option&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_racct-low&nbsp;=&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;s_racct&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;=&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-tsaknr&nbsp;&lt;&gt;&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_racct-sign&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_racct-option&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_racct-low&nbsp;=&nbsp;&lt;gs_fit001&gt;-tsaknr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;s_racct&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;&lt;&gt;&nbsp;''&nbsp;AND&nbsp;&lt;gs_fit001&gt;-tsaknr&nbsp;&lt;&gt;&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_racct-sign&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_racct-option&nbsp;=&nbsp;'BT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_racct-low&nbsp;=&nbsp;&lt;gs_fit001&gt;-fsaknr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_racct-high&nbsp;=&nbsp;&lt;gs_fit001&gt;-tsaknr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;s_racct&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;s_racct&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"将参数写入内存，并调用事务<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORT&nbsp;p_bukrs&nbsp;=&nbsp;p_bukrs&nbsp;TO&nbsp;MEMORY&nbsp;ID&nbsp;'BUKRS'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORT&nbsp;s_racct&nbsp;=&nbsp;s_racct[]&nbsp;TO&nbsp;MEMORY&nbsp;ID&nbsp;'RACCT'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORT&nbsp;p_ryear&nbsp;=&nbsp;p_ryear&nbsp;TO&nbsp;MEMORY&nbsp;ID&nbsp;'RYEAR'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORT&nbsp;p_rpmax&nbsp;=&nbsp;p_rpmax&nbsp;TO&nbsp;MEMORY&nbsp;ID&nbsp;'RPMAX'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORT&nbsp;zi&nbsp;=&nbsp;zi&nbsp;TO&nbsp;MEMORY&nbsp;ID&nbsp;'ZI'&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBMIT&nbsp;zfib_010_1&nbsp;AND&nbsp;RETURN.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
ENDFORM.<br />
FORM mod_sel_text USING p_repid kind parameter text .<br />
&nbsp;&nbsp;DATA&nbsp;sel&nbsp;TYPE&nbsp;rsseltexts&nbsp;OCCURS&nbsp;1&nbsp;WITH&nbsp;HEADER&nbsp;LINE.<br />
<br />
&nbsp;&nbsp;REFRESH&nbsp;sel.<br />
&nbsp;&nbsp;sel-name&nbsp;=&nbsp;parameter.<br />
&nbsp;&nbsp;sel-kind&nbsp;=&nbsp;kind.<br />
&nbsp;&nbsp;sel-text&nbsp;&nbsp;&nbsp;=&nbsp;text.<br />
&nbsp;&nbsp;APPEND&nbsp;sel.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'SELECTION_TEXTS_MODIFY'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;p_repid<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seltexts&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sel<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program_not_found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program_cannot_be_generated&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;sy-msgid&nbsp;TYPE&nbsp;sy-msgty&nbsp;NUMBER&nbsp;sy-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;sy-msgv1&nbsp;sy-msgv2&nbsp;sy-msgv3&nbsp;sy-msgv4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;frm_authority_check_bukrs<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_authority_check_bukrs .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;aut_bukrs&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bukrs&nbsp;LIKE&nbsp;t001-bukrs,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;aut_bukrs.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;bukrs&nbsp;INTO&nbsp;TABLE&nbsp;aut_bukrs&nbsp;FROM&nbsp;t001&nbsp;WHERE&nbsp;bukrs&nbsp;=&nbsp;p_bukrs.<br />
&nbsp;&nbsp;IF&nbsp;lines(&nbsp;aut_bukrs&nbsp;)&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e888(sabapdocu)&nbsp;WITH&nbsp;'您输入的公司代码不正确！'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;aut_bukrs.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AUTHORITY-CHECK&nbsp;OBJECT&nbsp;'F_BKPF_BUK'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID&nbsp;'BUKRS'&nbsp;FIELD&nbsp;aut_bukrs-bukrs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID&nbsp;'ACTVT'&nbsp;FIELD&nbsp;'03'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e888(sabapdocu)&nbsp;WITH&nbsp;'您没有公司代码'&nbsp;aut_bukrs-bukrs&nbsp;'的权限！'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;ZF4_HELP_LOW<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM zf4_help_low .<br />
&nbsp;&nbsp;SELECT&nbsp;version&nbsp;FROM&nbsp;zfit_003&nbsp;INTO&nbsp;TABLE&nbsp;@DATA(lt_zfit_003).<br />
&nbsp;&nbsp;SORT&nbsp;lt_zfit_003&nbsp;BY&nbsp;version.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;lt_zfit_003&nbsp;COMPARING&nbsp;version.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'F4IF_INT_TABLE_VALUE_REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DDIC_STRUCTURE&nbsp;&nbsp;=&nbsp;'&nbsp;'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retfield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'VERSION'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PVALKEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'&nbsp;'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpprog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-cprog<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-dynnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynprofield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'P_VERS'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WINDOW_TITLE&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'&nbsp;'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_org&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'S'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MULTIPLE_CHOICE&nbsp;=&nbsp;'&nbsp;'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISPLAY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'&nbsp;'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALLBACK_PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'&nbsp;'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALLBACK_FORM&nbsp;&nbsp;&nbsp;=&nbsp;'&nbsp;'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARK_TAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USER_RESET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_zfit_003<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIELD_TAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN_TAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPFLD_MAPPING&nbsp;=<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter_error&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_values_found&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
<br />
ENDFORM.<br />
<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*FORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;VALUE(PV_ROW)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE(PV_COLUMN)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE(PV_DATUM)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE(PV_IS_NUMBER).<br />
*&nbsp;&nbsp;IF&nbsp;PV_IS_NUMBER&nbsp;=&nbsp;1&nbsp;AND&nbsp;PV_DATUM&nbsp;&lt;&gt;&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_WSHEETOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'CELLS'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GV_CELLOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PV_ROW<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PV_COLUMN.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;GV_CELLOBJ&nbsp;'VALUE'&nbsp;=&nbsp;PV_DATUM.<br />
*&nbsp;&nbsp;ELSEIF&nbsp;PV_IS_NUMBER&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_WSHEETOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'CELLS'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GV_CELLOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PV_ROW<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PV_COLUMN.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;GV_CELLOBJ&nbsp;'VALUE'&nbsp;=&nbsp;PV_DATUM.<br />
*<br />
*&nbsp;&nbsp;ELSEIF&nbsp;PV_IS_NUMBER&nbsp;=&nbsp;2.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_WSHEETOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'CELLS'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GV_CELLOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PV_ROW<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PV_COLUMN.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;GV_CELLOBJ&nbsp;'VALUE'&nbsp;=&nbsp;PV_DATUM.<br />
*&nbsp;&nbsp;ENDIF&nbsp;.<br />
*ENDFORM.<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;frm_display_seting<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_display_seting .<br />
   </div>
   <div class="codeComment">
*明显输出<br />
<br />
*&nbsp;&nbsp;CONDENSE&nbsp;GV_LINE&nbsp;NO-GAPS&nbsp;.<br />
*&nbsp;&nbsp;CONCATENATE&nbsp;'V'&nbsp;GV_LINE&nbsp;&nbsp;INTO&nbsp;GV_LINE&nbsp;.<br />
**&nbsp;花框<br />
*&nbsp;&nbsp;PERFORM&nbsp;FRM_DISPLAY_BORDER&nbsp;USING&nbsp;'A1'&nbsp;GV_LINE.<br />
*&nbsp;&nbsp;PERFORM&nbsp;FRM_DISPLAY_STYLE_SETING.<br />
<br />
<br />
   </div>
   <div class="code">
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;frm_display_border<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;GV_LINE<br />
*&---------------------------------------------------------------------*<br />
*FORM&nbsp;FRM_DISPLAY_BORDER&nbsp;&nbsp;USING&nbsp;VALUE(PV_START_CELLNAME)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE(PV_END_CELLNAME).<br />
*<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_WSHEETOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Range'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GV_ROWSOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PV_START_CELLNAME<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PV_END_CELLNAME.<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF<br />
*&nbsp;&nbsp;&nbsp;&nbsp;GV_ROWSOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;'Select'.<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF<br />
*&nbsp;&nbsp;&nbsp;&nbsp;GV_ROWSOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Borders'&nbsp;=&nbsp;GV_BORDERSOBJ.<br />
*&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;GV_BORDERSOBJ&nbsp;'LineStyle'&nbsp;=&nbsp;1.<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_WSHEETOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Range'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GV_ROWSOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PV_START_CELLNAME.<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF<br />
*&nbsp;&nbsp;&nbsp;&nbsp;GV_ROWSOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;'Select'.<br />
*ENDFORM.<br />
**&---------------------------------------------------------------------*<br />
**&&nbsp;Form&nbsp;frm_display_style_seting<br />
**&---------------------------------------------------------------------*<br />
**&&nbsp;text<br />
**&---------------------------------------------------------------------*<br />
**&&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
**&&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
**&---------------------------------------------------------------------*<br />
*FORM&nbsp;FRM_DISPLAY_STYLE_SETING&nbsp;.<br />
**设置列宽度<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_WSHEETOBJ<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Columns'&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GV_COLUMNSOBJ<br />
*&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
*&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;GV_COLUMNSOBJ&nbsp;'ColumnWidth'&nbsp;=&nbsp;18.<br />
*&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;GV_COLUMNSOBJ&nbsp;'NumberFormat'&nbsp;=&nbsp;'@'.<br />
*ENDFORM.<br />
**&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;frm_get_fullpath<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--&nbsp;L_FULLPATH<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--&nbsp;L_PATH<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--&nbsp;L_NAME<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_get_fullpath CHANGING p_pv_fullpath<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_pv_path<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_pv_name.<br />
&nbsp;&nbsp;DATA:&nbsp;pv_init_path&nbsp;&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pv_init_fname&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pv_path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pv_filename&nbsp;&nbsp;&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pv_fullpath&nbsp;&nbsp;&nbsp;TYPE&nbsp;string.<br />
<br />
&nbsp;&nbsp;gv_index&nbsp;=&nbsp;gv_index&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'资产负债表_'&nbsp;gv_index&nbsp;'_'&nbsp;sy-datum&nbsp;INTO&nbsp;pv_init_fname.<br />
   </div>
   <div class="codeComment">
*&nbsp;初始名称(输出的文件名称)<br />
*&nbsp;&nbsp;CASE&nbsp;sy-ucomm.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'&SHD'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'送货单_'&nbsp;gv_index&nbsp;'_'&nbsp;sy-datum&nbsp;INTO&nbsp;pv_init_fname.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'&PL'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'清关PL_'&nbsp;gv_index&nbsp;'_'&nbsp;sy-datum&nbsp;INTO&nbsp;pv_init_fname.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'&CI'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'清关CI_'&nbsp;&nbsp;gv_index&nbsp;'_'&nbsp;sy-datum&nbsp;INTO&nbsp;pv_init_fname.<br />
*&nbsp;&nbsp;ENDCASE.<br />
<br />
*&nbsp;获取桌面路径<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_gui_frontend_services=&gt;get_desktop_directory<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desktop_directory&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_init_path<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntl_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_no_gui&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_supported_by_gui&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;用户选择名称、路径<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_gui_frontend_services=&gt;file_save_dialog<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window_title&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'指定保存文件名'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT_EXTENSION&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'.DOCX'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_file_name&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_init_fname<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_filter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;cl_gui_frontend_services=&gt;filetype_excel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"保存格式<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE_FILTER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;CL_GUI_FRONTEND_SERVICES=&gt;FILETYPE_EXCEL<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial_directory&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_init_path<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prompt_on_overwrite&nbsp;&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_filename<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_path<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fullpath&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_fullpath<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USER_ACTION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE_ENCODING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntl_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_no_gui&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_supported_by_gui&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;p_pv_fullpath&nbsp;=&nbsp;pv_fullpath.<br />
&nbsp;&nbsp;&nbsp;&nbsp;p_pv_path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_path.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;frm_crt_excel<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;L_FULLPATH<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;L_PATH<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_crt_excel USING p_filename p_path.<br />
   </div>
   <div class="codeComment">
*&nbsp;下载模版文件<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;frm_download_excel_from_server&nbsp;USING&nbsp;p_filename.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;打开excel<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;frm_open_excel&nbsp;USING&nbsp;p_filename.<br />
<br />
   </div>
   <div class="codeComment">
*sheet页复制<br />
*&nbsp;&nbsp;PERFORM&nbsp;FRM_SHEET_COPY.<br />
<br />
*&nbsp;向每一个sheet页填充数据<br />
*&nbsp;&nbsp;CASE&nbsp;sy-ucomm.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'&SHD'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;frm_fill_sheet_shd&nbsp;TABLES&nbsp;&nbsp;gt_show_data.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'&PL'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;frm_fill_sheet_pl.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'&CI'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;frm_fill_sheet_ci.<br />
*&nbsp;&nbsp;ENDCASE.<br />
<br />
<br />
*&nbsp;保存文件<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;myworkbook&nbsp;'SAVE'.<br />
<br />
&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;myexcel&nbsp;'VISIBLE'&nbsp;=&nbsp;1.<br />
   </div>
   <div class="codeComment">
**&nbsp;关闭文件<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;MYWORKBOOK&nbsp;'CLOSE'.<br />
*<br />
**&nbsp;退出excel<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;MYEXCEL&nbsp;'QUIT'.<br />
<br />
**&nbsp;释放对象<br />
   </div>
   <div class="code">
&nbsp;&nbsp;FREE&nbsp;OBJECT&nbsp;mysheet.<br />
&nbsp;&nbsp;FREE&nbsp;OBJECT&nbsp;myworkbook.<br />
&nbsp;&nbsp;FREE&nbsp;OBJECT&nbsp;myexcel.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;frm_download_excel_from_server<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_FILENAME<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_download_excel_from_server USING p_filename.<br />
&nbsp;&nbsp;DATA:&nbsp;l_objdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;wwwdatatab,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_mime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;w3mime,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_destination&nbsp;LIKE&nbsp;rlgrap-filename,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_objnam&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_rc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;sy-subrc,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_errtxt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;string.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;l_filename&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_result,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_subrc&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;sy-subrc.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;l_objid&nbsp;TYPE&nbsp;wwwdatatab-objid&nbsp;.<br />
&nbsp;&nbsp;CLEAR&nbsp;l_objid.<br />
&nbsp;&nbsp;l_objid&nbsp;=&nbsp;'ZFIB_010'.<br />
<br />
&nbsp;&nbsp;"查找文件是否存在。<br />
&nbsp;&nbsp;CLEAR&nbsp;l_objdata.<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;relid&nbsp;objid<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;wwwdata<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;l_objdata<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;srtf2&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;relid&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'MI'<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;objid&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_objid.<br />
<br />
&nbsp;&nbsp;"判断模版不存在则报错<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0&nbsp;OR&nbsp;l_objdata-objid&nbsp;EQ&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'模板文件：'&nbsp;l_objid&nbsp;'不存在，请用TCODE：SMW0进行加载'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;l_errtxt.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e000(su)&nbsp;WITH&nbsp;l_errtxt.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;CLEAR&nbsp;l_filename.<br />
&nbsp;&nbsp;l_filename&nbsp;=&nbsp;p_filename.<br />
<br />
&nbsp;&nbsp;"判断本地地址是否已经存在此文件。<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_gui_frontend_services=&gt;file_exist<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_filename<br />
&nbsp;&nbsp;&nbsp;&nbsp;RECEIVING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_result<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntl_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_no_gui&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrong_parameter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_supported_by_gui&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;IF&nbsp;l_result&nbsp;EQ&nbsp;'X'.&nbsp;&nbsp;"如果存在则删除原始文件，重新覆盖<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_gui_frontend_services=&gt;file_delete<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_filename<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_subrc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_delete_failed&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntl_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_no_gui&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_not_found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access_denied&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unknown_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_supported_by_gui&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrong_parameter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;9.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;l_subrc&nbsp;&lt;&gt;&nbsp;0.&nbsp;"如果删除失败，则报错。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'同名EXCEL文件已打开'&nbsp;'请关闭该EXCEL后重试。'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;l_errtxt.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e000(su)&nbsp;WITH&nbsp;l_errtxt.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;CLEAR&nbsp;l_destination.<br />
&nbsp;&nbsp;l_destination&nbsp;&nbsp;&nbsp;=&nbsp;p_filename.<br />
<br />
&nbsp;&nbsp;"下载模版。<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'DOWNLOAD_WEB_OBJECT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_objdata<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination&nbsp;=&nbsp;l_destination<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;l_rc.<br />
&nbsp;&nbsp;IF&nbsp;l_rc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'模板文件'&nbsp;'下载失败'&nbsp;INTO&nbsp;l_errtxt.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e000(su)&nbsp;WITH&nbsp;l_errtxt.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;frm_fill_sheet_shd<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_fill_sheet_shd TABLES pt_table TYPE STANDARD TABLE .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;lt_show_data&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;show_data.<br />
&nbsp;&nbsp;DATA:lv_lines_item&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;REFRESH&nbsp;lt_show_data[]&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;&nbsp;&nbsp;lv_xh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;lv_xh&nbsp;&nbsp;&nbsp;=&nbsp;3&nbsp;.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;pt_table[]&nbsp;TO&nbsp;lt_show_data&nbsp;.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_show_data&nbsp;INTO&nbsp;DATA(ps_table)&nbsp;..<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_xh&nbsp;&nbsp;=&nbsp;lv_xh&nbsp;&nbsp;&nbsp;+&nbsp;1&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;f_fill_cell&nbsp;USING&nbsp;lv_xh&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;ps_table-ztext&nbsp;&nbsp;.&nbsp;"序号<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;f_fill_cell&nbsp;USING&nbsp;lv_xh&nbsp;2&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;ps_table-dmbtr&nbsp;&nbsp;.&nbsp;"序号<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;f_fill_cell&nbsp;USING&nbsp;lv_xh&nbsp;3&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;ps_table-hslvt&nbsp;&nbsp;.&nbsp;"序号<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;f_fill_cell&nbsp;USING&nbsp;lv_xh&nbsp;4&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;ps_table-ztext1&nbsp;.&nbsp;"序号<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;f_fill_cell&nbsp;USING&nbsp;lv_xh&nbsp;5&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;ps_table-dmbtr1&nbsp;.&nbsp;"序号<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;f_fill_cell&nbsp;USING&nbsp;lv_xh&nbsp;6&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;ps_table-hslvt1&nbsp;.&nbsp;"序号<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;LV_LINES_ITEM&nbsp;=&nbsp;15.<br />
<br />
<br />
*&nbsp;&nbsp;GV_I_ROW&nbsp;=&nbsp;&nbsp;3&nbsp;.<br />
*&nbsp;&nbsp;BREAK-POINT&nbsp;.<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_SHOW_DATA&nbsp;INTO&nbsp;DATA(PS_TABLE)&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;"循环整个内表&nbsp;&nbsp;输入得到的资产负债数据到excel中&nbsp;&nbsp;&nbsp;整合复制粘贴法的内表中<br />
*&nbsp;&nbsp;&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;=&nbsp;GV_I_ROW&nbsp;&nbsp;+&nbsp;1&nbsp;&nbsp;.<br />
*<br />
*<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;PS_TABLE-ZTEXT&nbsp;&nbsp;0.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;PS_TABLE-DMBTR&nbsp;&nbsp;0&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;PS_TABLE-HSLVT&nbsp;0.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;PS_TABLE-ZTEXT1&nbsp;0.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;PS_TABLE-DMBTR1&nbsp;0.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_XLS&nbsp;USING&nbsp;&nbsp;GV_I_ROW&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;PS_TABLE-HSLVT1&nbsp;0.<br />
*<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;1&nbsp;PS_TABLE-ZTEXT&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;2&nbsp;PS_TABLE-DMBTR&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;3&nbsp;PS_TABLE-HSLVT&nbsp;''&nbsp;''&nbsp;.<br />
***&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;4&nbsp;PS_TABLE-ZROW1&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;4&nbsp;PS_TABLE-ZTEXT1&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;5&nbsp;PS_TABLE-DMBTR1&nbsp;''&nbsp;''&nbsp;.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FILL_CELL&nbsp;USING&nbsp;GV_I_ROW&nbsp;6&nbsp;PS_TABLE-HSLVT1&nbsp;''&nbsp;''&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&nbsp;PS_TABLE&nbsp;.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
<br />
   </div>
   <div class="code">
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;FRM_OPEN_EXCEL<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_FILENAME<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_open_excel USING p_filename.<br />
&nbsp;&nbsp;"打开excel应用<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;myexcel&nbsp;'EXCEL.APPLICATION'.<br />
<br />
&nbsp;&nbsp;"获取工作簿。<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;myexcel&nbsp;'WORKBOOKS'&nbsp;=&nbsp;myworkbook.<br />
<br />
&nbsp;&nbsp;"打开工作簿<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;myworkbook&nbsp;'OPEN'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;=&nbsp;p_filename.&nbsp;"开文件<br />
<br />
&nbsp;&nbsp;"设置活动的工作簿。<br />
&nbsp;&nbsp;GET&nbsp;PROPERTY&nbsp;OF&nbsp;myexcel&nbsp;'ACTIVEWORKBOOK'&nbsp;=&nbsp;myworkbook.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;F_FILL_CELL<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;LV_LINES_ITEM<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_1<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_0<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_0<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_0<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_0<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_1<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_0<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;P_0<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;LV_XH<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM f_fill_cell USING p_row p_col p_bold p_size p_position<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_color&nbsp;p_border&nbsp;p_format&nbsp;p_italic&nbsp;p_value.<br />
&nbsp;&nbsp;DATA:&nbsp;l_number&nbsp;TYPE&nbsp;char100.<br />
<br />
<br />
&nbsp;&nbsp;"定位到单元格<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;myexcel&nbsp;'CELLS'&nbsp;=&nbsp;mycell<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;=&nbsp;p_row<br />
&nbsp;&nbsp;&nbsp;&nbsp;#2&nbsp;=&nbsp;p_col.<br />
<br />
&nbsp;&nbsp;"填值，如果为数字，则取出前导空格。<br />
&nbsp;&nbsp;IF&nbsp;p_format&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;mycell&nbsp;'VALUE'&nbsp;=&nbsp;p_value.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;l_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE&nbsp;p_value&nbsp;TO&nbsp;l_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;l_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;mycell&nbsp;'VALUE'&nbsp;=&nbsp;l_number.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;p_border&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DO&nbsp;4&nbsp;TIMES&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;OF&nbsp;mycell&nbsp;'BORDERS'&nbsp;=&nbsp;borders<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#1&nbsp;=&nbsp;sy-index.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;borders&nbsp;'LineStyle'&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;borders&nbsp;'WEIGHT'&nbsp;=&nbsp;'2'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"4=max<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PROPERTY&nbsp;OF&nbsp;borders_obj&nbsp;'ColorIndex'&nbsp;=&nbsp;'1'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FREE&nbsp;OBJECT&nbsp;borders.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDDO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;FREE&nbsp;OBJECT&nbsp;borders.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;frm_processing_data1<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text&nbsp;往来单位客户的处理<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--&nbsp;&lt;GS_FIT001&gt;_FORMULA<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--&nbsp;GS_DMBTR_HSLVT<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--&nbsp;GS_DMBTR_DMBTR<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_processing_data1 USING p_fsaknr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_tsaknr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;p_gs_dmbtr_hslvt<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_gs_dmbtr_dmbtr.<br />
<br />
&nbsp;&nbsp;DATA:lv_ryear_end(7)&nbsp;TYPE&nbsp;c.<br />
&nbsp;&nbsp;DATA:lv_ryear_beg(7)&nbsp;TYPE&nbsp;c.<br />
<br />
&nbsp;&nbsp;lv_ryear_beg&nbsp;=&nbsp;p_ryear&nbsp;&&&nbsp;'001'.<br />
&nbsp;&nbsp;lv_ryear_end&nbsp;=&nbsp;p_ryear&nbsp;&&&nbsp;'0'&nbsp;&&&nbsp;p_rpmax.<br />
<br />
&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;kunnr,"客户号<br />
&nbsp;&nbsp;&nbsp;&nbsp;racct,"总账科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;zzfi01,"业务板块<br />
&nbsp;&nbsp;&nbsp;&nbsp;prctr,&nbsp;"利润中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;hsl&nbsp;&nbsp;&nbsp;&nbsp;"公司代码货币金额<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;@DATA(lt_acdoca)<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;acdoca<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;rbukrs&nbsp;EQ&nbsp;@p_bukrs&nbsp;&nbsp;"公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;racct&nbsp;LE&nbsp;@p_fsaknr&nbsp;&nbsp;&nbsp;"科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;racct&nbsp;GE&nbsp;@p_tsaknr&nbsp;&nbsp;&nbsp;"科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;prctr&nbsp;IN&nbsp;@s_prctr&nbsp;&nbsp;&nbsp;&nbsp;"利润中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;fiscyearper&nbsp;LE&nbsp;@lv_ryear_end&nbsp;&nbsp;"年度期间<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;fiscyearper&nbsp;GE&nbsp;@lv_ryear_beg.&nbsp;"年度期间.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;frm_processing_data2<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;text&nbsp;往来单位供应商的处理<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--&nbsp;&lt;GS_FIT001&gt;_FORMULA<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--&nbsp;GS_DMBTR_HSLVT<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--&nbsp;GS_DMBTR_DMBTR<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM frm_processing_data2 USING p_fsaknr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_tsaknr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;p_gs_dmbtr_hslvt<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_gs_dmbtr_dmbtr.<br />
<br />
&nbsp;&nbsp;DATA:lv_ryear_end(7)&nbsp;TYPE&nbsp;c.<br />
&nbsp;&nbsp;DATA:lv_ryear_beg(7)&nbsp;TYPE&nbsp;c.<br />
<br />
&nbsp;&nbsp;lv_ryear_beg&nbsp;=&nbsp;p_ryear&nbsp;&&&nbsp;'001'.<br />
&nbsp;&nbsp;lv_ryear_end&nbsp;=&nbsp;p_ryear&nbsp;&&&nbsp;'0'&nbsp;&&&nbsp;p_rpmax.<br />
<br />
&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lifnr,"供应商号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;racct,"总账科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zzfi01,"业务板块<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prctr,&nbsp;"利润中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsl&nbsp;&nbsp;&nbsp;&nbsp;"公司代码货币金额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;@DATA(lt_acdoca)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;acdoca<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;rbukrs&nbsp;EQ&nbsp;@p_bukrs&nbsp;&nbsp;"公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;racct&nbsp;LE&nbsp;@p_fsaknr&nbsp;&nbsp;&nbsp;"科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;racct&nbsp;GE&nbsp;@p_tsaknr&nbsp;&nbsp;&nbsp;"科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;prctr&nbsp;IN&nbsp;@s_prctr&nbsp;&nbsp;&nbsp;&nbsp;"利润中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;fiscyearper&nbsp;LE&nbsp;@lv_ryear_end&nbsp;&nbsp;"年度期间<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;fiscyearper&nbsp;GE&nbsp;@lv_ryear_beg.&nbsp;"年度期间.<br />
<br />
ENDFORM.<br />
<br />
MODULE status_9001 OUTPUT.<br />
   </div>
   <div class="codeComment">
*&nbsp;SET&nbsp;PF-STATUS&nbsp;'xxxxxxxx'.<br />
*&nbsp;SET&nbsp;TITLEBAR&nbsp;'xxx'.<br />
   </div>
   <div class="code">
ENDMODULE.<br />
<br />
MODULE user_command_9001 INPUT.<br />
&nbsp;&nbsp;CASE&nbsp;sy-ucomm.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'E'&nbsp;OR&nbsp;'ENDE'&nbsp;OR&nbsp;'ECAN'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'SPOS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;zfit_003&nbsp;FROM&nbsp;TABLE&nbsp;gt_alv1[].<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;zfit_003&nbsp;FROM&nbsp;TABLE&nbsp;gt_alv[].<br />
&nbsp;&nbsp;ENDCASE.<br />
ENDMODULE.<br />
<br />
MODULE out_screen_9001 OUTPUT.<br />
&nbsp;&nbsp;PERFORM&nbsp;frm_create_alv.<br />
ENDMODULE.<br />
<br />
FORM frm_create_alv.<br />
&nbsp;&nbsp;DATA:&nbsp;lt_f4&nbsp;TYPE&nbsp;lvc_t_f4&nbsp;WITH&nbsp;HEADER&nbsp;LINE.<br />
<br />
&nbsp;&nbsp;IF&nbsp;alv_container1&nbsp;IS&nbsp;INITIAL."绘制第一个ALV<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;alv_container1&nbsp;&nbsp;&nbsp;&nbsp;"创建ALV容器对象<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container_name&nbsp;=&nbsp;'CON1'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;side&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;cl_gui_docking_container=&gt;dock_at_left<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-repid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-dynnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extension&nbsp;=&nbsp;1800.&nbsp;"alv宽度<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;alv_grid1&nbsp;"创建ALV控件<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_parent&nbsp;=&nbsp;alv_container1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;frm_set_style.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;alv_grid1-&gt;set_table_for_first_display<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_layout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;layout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_outtab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_alv[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_fieldcatalog&nbsp;=&nbsp;fieldcat[].&nbsp;"如果fieldcat内表为空，则相当于没有配置，采用默认方式显示<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"为ALV按钮注册监听事件<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;:event_handle1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;:&nbsp;&nbsp;event_handle1-&gt;handle_toolbar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;alv_grid1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_handle1-&gt;handle_onf4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;alv_grid1."F4帮助注册事件<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_handle1-&gt;handle_user_command&nbsp;&nbsp;FOR&nbsp;alv_grid1,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_handle1-&gt;handle_enter&nbsp;&nbsp;FOR&nbsp;alv_grid1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_handle1-&gt;handle_hotspot_click&nbsp;FOR&nbsp;alv_grid1.<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;alv_grid1-&gt;set_toolbar_interactive.&nbsp;"调用此方法才能激活工具栏上增加的自定义按钮<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;alv_grid1-&gt;register_edit_event&nbsp;"注册编辑事件，否则不会触发更新事件<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_event_id&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_evt_modified.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lt_f4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_f4-fieldname&nbsp;=&nbsp;'ZJDQZ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_f4-register&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_f4-chngeafter&nbsp;=&nbsp;'X'."lvc_s_f4中的字段getbefore和changeafter应该代表是否触发data_changed事件。<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lt_f4.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lt_f4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_f4-fieldname&nbsp;=&nbsp;'ZWLDW'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_f4-register&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_f4-chngeafter&nbsp;=&nbsp;'X'."lvc_s_f4中的字段getbefore和changeafter应该代表是否触发data_changed事件。<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lt_f4&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;alv_grid1-&gt;register_f4_for_fields&nbsp;"在创建ALV对象之后，要对需要自定义搜索帮助的字段进行注册。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_f4&nbsp;=&nbsp;lt_f4[].<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lt_f41.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;lt_f41-fieldname&nbsp;=&nbsp;'ZJDQZ'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;lt_f41-register&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;lt_f41-chngeafter&nbsp;=&nbsp;'X'."lvc_s_f4中的字段getbefore和changeafter应该代表是否触发data_changed事件。<br />
*&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lt_f41.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;alv_grid1-&gt;register_f4_for_fields&nbsp;"在创建ALV对象之后，要对需要自定义搜索帮助的字段进行注册。<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_f4&nbsp;=&nbsp;lt_f41[].<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;alv_grid1-&gt;refresh_table_display.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
FORM frm_refresh_display.<br />
&nbsp;&nbsp;DATA&nbsp;stbl&nbsp;TYPE&nbsp;lvc_s_stbl.<br />
<br />
&nbsp;&nbsp;stbl-row&nbsp;=&nbsp;'X'.&nbsp;"&nbsp;基于行的稳定刷新<br />
&nbsp;&nbsp;stbl-col&nbsp;=&nbsp;'X'.&nbsp;"&nbsp;基于列稳定刷新<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;alv_grid1-&gt;refresh_table_display<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_stable&nbsp;=&nbsp;stbl.<br />
<br />
ENDFORM.<br />
<br />
FORM frm_set_style.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;layout-cwidth_opt&nbsp;=&nbsp;abap_true.<br />
*&nbsp;&nbsp;layout-sel_mode&nbsp;&nbsp;&nbsp;=&nbsp;''.<br />
*&nbsp;&nbsp;layout-zebra&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abap_true.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DEFINE&nbsp;set_fieldcat.<br />
&nbsp;&nbsp;&nbsp;&nbsp;fieldcat-fieldname&nbsp;=&nbsp;&1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;fieldcat-scrtext_m&nbsp;=&nbsp;&2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;fieldcat-edit&nbsp;=&nbsp;&3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;fieldcat-f4availabl&nbsp;=&nbsp;&4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;fieldcat-outputlen&nbsp;=&nbsp;&5.<br />
&nbsp;&nbsp;&nbsp;&nbsp;fieldcat-ref_field&nbsp;=&nbsp;&6.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&nbsp;fieldcat.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;fieldcat.<br />
&nbsp;&nbsp;END-OF-DEFINITION.<br />
&nbsp;&nbsp;set_fieldcat&nbsp;:&nbsp;"'BUKRS'&nbsp;&nbsp;&nbsp;'公司代码'&nbsp;'X',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ZTYPE'&nbsp;&nbsp;&nbsp;'报表类型'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'VERSION'&nbsp;'版本编号'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ZCOLUMN'&nbsp;'列编号'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ZROW'&nbsp;&nbsp;&nbsp;&nbsp;'行号'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ZSNUM'&nbsp;&nbsp;&nbsp;'序号'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'LANGU'&nbsp;&nbsp;&nbsp;'语言代码'&nbsp;'X',<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ZTEXT'&nbsp;&nbsp;&nbsp;'描述'&nbsp;'X'&nbsp;''&nbsp;'60'&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'FSAKNR'&nbsp;&nbsp;'起始科目号'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'TSAKNR'&nbsp;&nbsp;'结束科目号'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ZWLDW'&nbsp;&nbsp;&nbsp;'往来单位'&nbsp;'X'&nbsp;'X'&nbsp;''&nbsp;'',<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'FRFAREA'&nbsp;'起始功能范围'&nbsp;'X',<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'TRFAREA'&nbsp;'结束功能范围'&nbsp;'X',<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'RSTGR'&nbsp;&nbsp;&nbsp;'现金流量码'&nbsp;'X',<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ZJFBS'&nbsp;&nbsp;&nbsp;'借方标识'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ZDFBS'&nbsp;&nbsp;&nbsp;'贷方标识'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'RSTGR'&nbsp;&nbsp;&nbsp;'现金流量码'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'REVERSAL'&nbsp;'正负反转'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'KURST'&nbsp;&nbsp;&nbsp;'汇率类型'&nbsp;'X',<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'SHKZGS'&nbsp;'借方标识'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'SHKZGH'&nbsp;'贷方标识'&nbsp;'X'&nbsp;''&nbsp;''&nbsp;'',<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ZJDQZ'&nbsp;&nbsp;'借贷取值'&nbsp;'X'&nbsp;'X'&nbsp;''&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'FORMULA'&nbsp;'计算公式'&nbsp;'X'&nbsp;''&nbsp;'128'&nbsp;''.<br />
<br />
ENDFORM.<br />
FORM frm_get_data.<br />
&nbsp;&nbsp;REFRESH&nbsp;gt_alv[].<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;&nbsp;"获取配置表数据&nbsp;&nbsp;资产负债表对应科目范围<br />
&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;gt_alv<br />
&nbsp;&nbsp;&nbsp;FROM&nbsp;zfit_003<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;bukrs&nbsp;=&nbsp;''<br />
&nbsp;&nbsp;&nbsp;AND&nbsp;ztype&nbsp;&nbsp;&nbsp;=&nbsp;'BS'<br />
&nbsp;&nbsp;&nbsp;AND&nbsp;version&nbsp;=&nbsp;p_vers.<br />
&nbsp;&nbsp;SORT&nbsp;&nbsp;gt_alv&nbsp;BY&nbsp;zcolumn&nbsp;zrow.<br />
&nbsp;&nbsp;gt_alv1[]&nbsp;=&nbsp;gt_alv[].<br />
<br />
&nbsp;&nbsp;IF&nbsp;p_1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;gt_fit001[]&nbsp;=&nbsp;gt_alv[]&nbsp;.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_show_data&nbsp;TYPE&nbsp;show_data.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;s_prctr-high&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s_prctr-high&nbsp;=&nbsp;s_prctr-low.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;gt_zfit_024<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zfit_024<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;bukrs&nbsp;EQ&nbsp;p_bukrs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;gjahr&nbsp;EQ&nbsp;p_ryear<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;fprctr&nbsp;LE&nbsp;s_prctr-high<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;tprctr&nbsp;GE&nbsp;s_prctr-low<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;poper&nbsp;EQ&nbsp;p_rpmax.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_zfit_024&nbsp;INTO&nbsp;DATA(ls_zfit_024).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ls_zfit_024&nbsp;TO&nbsp;ls_show_data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_show_data&nbsp;TO&nbsp;gt_show_data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;ls_show_data,&nbsp;ls_zfit_024.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
FORM frm_update_data .<br />
&nbsp;&nbsp;DATA:&nbsp;lt_zfit_024&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zfit_024,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_zfit_024&nbsp;TYPE&nbsp;&nbsp;zfit_024.<br />
&nbsp;&nbsp;IF&nbsp;s_prctr-high&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;s_prctr-high&nbsp;=&nbsp;s_prctr-low.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_show_data&nbsp;INTO&nbsp;DATA(ls_show_data).<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ls_show_data&nbsp;TO&nbsp;ls_zfit_024.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_zfit_024-bukrs&nbsp;=&nbsp;p_bukrs.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_zfit_024-fprctr&nbsp;=&nbsp;s_prctr-low.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_zfit_024-tprctr&nbsp;=&nbsp;s_prctr-high.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_zfit_024-gjahr&nbsp;=&nbsp;p_ryear.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_zfit_024-poper&nbsp;=&nbsp;p_rpmax.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_zfit_024-datum&nbsp;=&nbsp;sy-datum.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_zfit_024-uzeit&nbsp;=&nbsp;sy-uzeit.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_zfit_024&nbsp;TO&nbsp;lt_zfit_024.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_zfit_024.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;@DATA(lt_zfit_0241)&nbsp;FROM&nbsp;zfit_024&nbsp;WHERE&nbsp;bukrs&nbsp;EQ&nbsp;@p_bukrs&nbsp;AND&nbsp;gjahr&nbsp;EQ&nbsp;@p_ryear&nbsp;AND&nbsp;fprctr&nbsp;LE&nbsp;@s_prctr-high&nbsp;AND&nbsp;tprctr&nbsp;GE&nbsp;@s_prctr-low&nbsp;AND&nbsp;poper&nbsp;EQ&nbsp;@p_rpmax.<br />
&nbsp;&nbsp;DELETE&nbsp;zfit_024&nbsp;FROM&nbsp;TABLE&nbsp;lt_zfit_0241.<br />
&nbsp;&nbsp;MODIFY&nbsp;zfit_024&nbsp;FROM&nbsp;TABLE&nbsp;lt_zfit_024.<br />
&nbsp;&nbsp;MESSAGE&nbsp;'保存成功'&nbsp;TYPE&nbsp;'S'.<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*Selection&nbsp;texts<br />
*----------------------------------------------------------<br />
*&nbsp;P_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询已存数据<br />
*&nbsp;P_BUKRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;公司代码<br />
*&nbsp;P_RPMAX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;会计期间<br />
*&nbsp;P_RYEAR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;会计年度<br />
*&nbsp;P_VERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;版本编号<br />
*&nbsp;S_PRCTR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;利润中心<br />
<br />
<br />
*Messages<br />
*----------------------------------------------------------<br />
*<br />
*&nbsp;Message&nbsp;class:&nbsp;Hard&nbsp;coded<br />
*&nbsp;&nbsp;&nbsp;没有资产负债表对应配置数据!!<br />
*<br />
*&nbsp;Message&nbsp;class:&nbsp;SABAPDOCU<br />
*888&nbsp;&nbsp;&nbsp;&&nbsp;&&nbsp;&&nbsp;&<br />
*<br />
*&nbsp;Message&nbsp;class:&nbsp;SU<br />
*000&nbsp;&nbsp;&nbsp;&&nbsp;&&nbsp;&&nbsp;&<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">Extracted by Mass Download version 1.5.5 - E.G.Mellodew. 1998-2022. Sap Release 755</td>
   </tr>
</table>
</body>
</html>
